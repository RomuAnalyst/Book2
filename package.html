<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 5 Créer un package R par la pratique | Résumé des cours et TP - DU Dataviz</title>
  <meta name="description" content="Support à destination des R-newbies" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 5 Créer un package R par la pratique | Résumé des cours et TP - DU Dataviz" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Support à destination des R-newbies" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 5 Créer un package R par la pratique | Résumé des cours et TP - DU Dataviz" />
  
  <meta name="twitter:description" content="Support à destination des R-newbies" />
  

<meta name="author" content="Romuald ZAMI" />
<meta name="author" content="et contributeurs" />


<meta name="date" content="2022-06-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="git.html"/>

<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<link href="libs/font-awesome/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
<script>
function unrolltab(evt, tabName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Romuald ZAMI - DU Dataviz</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Préface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributeurs"><i class="fa fa-check"></i>Contributeurs <i class="far fa-user-secret"></i></a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#utilisation-des-icônes"><i class="fa fa-check"></i>Utilisation des icônes</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Objectif de la formation</a></li>
<li class="chapter" data-level="2" data-path="présentation-de-r-et-de-son-environnement.html"><a href="présentation-de-r-et-de-son-environnement.html"><i class="fa fa-check"></i><b>2</b> Présentation de R et de son environnement</a>
<ul>
<li class="chapter" data-level="2.1" data-path="présentation-de-r-et-de-son-environnement.html"><a href="présentation-de-r-et-de-son-environnement.html#quest-ce-que"><i class="fa fa-check"></i><b>2.1</b> Qu’est-ce que <i class="fab fa-r-project"></i> ?</a></li>
<li class="chapter" data-level="2.2" data-path="présentation-de-r-et-de-son-environnement.html"><a href="présentation-de-r-et-de-son-environnement.html#prise-en-main-de-r-studio"><i class="fa fa-check"></i><b>2.2</b> Prise en main de <strong>R-studio</strong></a></li>
<li class="chapter" data-level="2.3" data-path="présentation-de-r-et-de-son-environnement.html"><a href="présentation-de-r-et-de-son-environnement.html#laide-en-ligne"><i class="fa fa-check"></i><b>2.3</b> L’aide en ligne</a></li>
<li class="chapter" data-level="2.4" data-path="présentation-de-r-et-de-son-environnement.html"><a href="présentation-de-r-et-de-son-environnement.html#packages"><i class="fa fa-check"></i><b>2.4</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ggplo2.html"><a href="ggplo2.html"><i class="fa fa-check"></i><b>3</b> Utiliser <em>GGplot2</em> pour faire et superposer des graphiques</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="ggplo2.html"><a href="ggplo2.html#introduction"><i class="fa fa-check"></i><b>3.0.1</b> Introduction</a></li>
<li class="chapter" data-level="3.0.2" data-path="ggplo2.html"><a href="ggplo2.html#mapping"><i class="fa fa-check"></i><b>3.0.2</b> Le <em>mapping</em> et l’utilisation d’<code>aes()</code></a></li>
<li class="chapter" data-level="3.0.3" data-path="ggplo2.html"><a href="ggplo2.html#les-formes-géométriques"><i class="fa fa-check"></i><b>3.0.3</b> Les formes géométriques</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>4</b> Utiliser <code>GIT</code> avec <i class="fab fa-r-project"></i></a>
<ul>
<li class="chapter" data-level="4.1" data-path="git.html"><a href="git.html#pourquoi-utiliser-la-gestion-de-version"><i class="fa fa-check"></i><b>4.1</b> Pourquoi utiliser la gestion de version ?</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="git.html"><a href="git.html#conserver-et-archiver-du-code"><i class="fa fa-check"></i><b>4.1.1</b> Conserver et archiver du code</a></li>
<li class="chapter" data-level="4.1.2" data-path="git.html"><a href="git.html#travailler-efficacement-en-équipe"><i class="fa fa-check"></i><b>4.1.2</b> Travailler efficacement en équipe</a></li>
<li class="chapter" data-level="4.1.3" data-path="git.html"><a href="git.html#améliorer-la-qualité-des-codes"><i class="fa fa-check"></i><b>4.1.3</b> Améliorer la qualité des codes</a></li>
<li class="chapter" data-level="4.1.4" data-path="git.html"><a href="git.html#usage-quotidien-un-exemple-avec-le-modèle-ines"><i class="fa fa-check"></i><b>4.1.4</b> Usage quotidien : un exemple avec le modèle Ines</a></li>
<li class="chapter" data-level="4.1.5" data-path="git.html"><a href="git.html#avec-ou-sans-gestion-de-versions"><i class="fa fa-check"></i><b>4.1.5</b> Avec ou sans gestion de versions</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="git.html"><a href="git.html#configurer-un-projet-git-avec-rstudio-à-linsee"><i class="fa fa-check"></i><b>4.2</b> Configurer un projet <code>GIT</code> avec RStudio à l’Insee</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="git.html"><a href="git.html#la-première-fois"><i class="fa fa-check"></i><b>4.2.1</b> La première fois</a></li>
<li class="chapter" data-level="4.2.2" data-path="git.html"><a href="git.html#au-lancement-de-chaque-projet-cloner-depuis-gitlab.insee.fr"><i class="fa fa-check"></i><b>4.2.2</b> Au lancement de chaque projet, cloner depuis <code>gitlab.insee.fr</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="git.html"><a href="git.html#des-bases-de-git"><i class="fa fa-check"></i><b>4.3</b> Des bases de GIT <i class="fas fa-code-branch"></i></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="git.html"><a href="git.html#le-b.a-ba"><i class="fa fa-check"></i><b>4.3.1</b> Le B.A-BA</a></li>
<li class="chapter" data-level="4.3.2" data-path="git.html"><a href="git.html#gitlocal"><i class="fa fa-check"></i><b>4.3.2</b> Exercice 1: Premiers pas avec <code>git</code> en local</a></li>
<li class="chapter" data-level="4.3.3" data-path="git.html"><a href="git.html#les-branches-principes"><i class="fa fa-check"></i><b>4.3.3</b> Les branches : principes</a></li>
<li class="chapter" data-level="4.3.4" data-path="git.html"><a href="git.html#branches-et-lien-avec-master"><i class="fa fa-check"></i><b>4.3.4</b> Branches et lien avec <code>master</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="git.html"><a href="git.html#quelques-compléments-de-git"><i class="fa fa-check"></i><b>4.3.5</b> Quelques compléments de GIT</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="git.html"><a href="git.html#gitlab"><i class="fa fa-check"></i><b>4.4</b> <code>GitLab</code> <i class="fab fa-gitlab"></i>, aperçu de la plateforme de partage de code</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="git.html"><a href="git.html#repository"><i class="fa fa-check"></i><b>4.4.1</b> <code>Repository</code></a></li>
<li class="chapter" data-level="4.4.2" data-path="git.html"><a href="git.html#issues"><i class="fa fa-check"></i><b>4.4.2</b> <code>Issues</code></a></li>
<li class="chapter" data-level="4.4.3" data-path="git.html"><a href="git.html#exercice-4-ouvrir-et-organiser-les-issues"><i class="fa fa-check"></i><b>4.4.3</b> Exercice 4 : Ouvrir et organiser les <em>issues</em></a></li>
<li class="chapter" data-level="4.4.4" data-path="git.html"><a href="git.html#merge-requests-mr"><i class="fa fa-check"></i><b>4.4.4</b> Merge requests (MR)</a></li>
<li class="chapter" data-level="4.4.5" data-path="git.html"><a href="git.html#exercice-4-fusionner-les-travaux-avec-des-merge-requests"><i class="fa fa-check"></i><b>4.4.5</b> Exercice 4 : Fusionner les travaux avec des <code>Merge Requests</code></a></li>
<li class="chapter" data-level="4.4.6" data-path="git.html"><a href="git.html#les-groupes"><i class="fa fa-check"></i><b>4.4.6</b> Les groupes</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="git.html"><a href="git.html#orgagit"><i class="fa fa-check"></i><b>4.5</b> Organiser le travail collaboratif</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="git.html"><a href="git.html#créer-une-branche"><i class="fa fa-check"></i><b>4.5.1</b> Créer une branche</a></li>
<li class="chapter" data-level="4.5.2" data-path="git.html"><a href="git.html#modifier-et-valider-ces-changements"><i class="fa fa-check"></i><b>4.5.2</b> Modifier et valider ces changements</a></li>
<li class="chapter" data-level="4.5.3" data-path="git.html"><a href="git.html#ouvrir-une-demande-de-fusion"><i class="fa fa-check"></i><b>4.5.3</b> Ouvrir une demande de fusion</a></li>
<li class="chapter" data-level="4.5.4" data-path="git.html"><a href="git.html#échanger-entre-collaborateurs-et-vérifier-le-code"><i class="fa fa-check"></i><b>4.5.4</b> Échanger entre collaborateurs et vérifier le code</a></li>
<li class="chapter" data-level="4.5.5" data-path="git.html"><a href="git.html#fusionner-la-branche-avec-master"><i class="fa fa-check"></i><b>4.5.5</b> Fusionner la branche avec <code>master</code></a></li>
<li class="chapter" data-level="4.5.6" data-path="git.html"><a href="git.html#exercice-5-résoudre-les-conflits-cest-facile."><i class="fa fa-check"></i><b>4.5.6</b> Exercice 5 : Résoudre les conflits, c’est facile.</a></li>
<li class="chapter" data-level="4.5.7" data-path="git.html"><a href="git.html#exercice-6-contribuer-à-un-dépôt-sans-droits-sur-master"><i class="fa fa-check"></i><b>4.5.7</b> Exercice 6 : Contribuer à un dépôt sans droits sur <code>master</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="package.html"><a href="package.html"><i class="fa fa-check"></i><b>5</b> Créer un <em>package</em> <code>R</code> par la pratique</a>
<ul>
<li class="chapter" data-level="" data-path="package.html"><a href="package.html#introduction-1"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="package.html"><a href="package.html#pré-requis"><i class="fa fa-check"></i>Pré-requis</a></li>
<li class="chapter" data-level="" data-path="package.html"><a href="package.html#brisons-quelques-mythes"><i class="fa fa-check"></i>Brisons quelques mythes !</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="package.html"><a href="package.html#quand-créer-un-package"><i class="fa fa-check"></i>Quand créer un <em>package</em> ?</a>
<ul>
<li class="chapter" data-level="" data-path="package.html"><a href="package.html#le-concept-de-package"><i class="fa fa-check"></i>Le concept de <em>package</em></a></li>
<li class="chapter" data-level="" data-path="package.html"><a href="package.html#feuille-de-route-pour-créer-un-package"><i class="fa fa-check"></i>Feuille de route pour créer un <em>package</em></a></li>
</ul></li>
<li class="chapter" data-level="5.1" data-path="package.html"><a href="package.html#initier-un-package"><i class="fa fa-check"></i><b>5.1</b> Initier un <em>package</em></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="package.html"><a href="package.html#choisir-un-nom"><i class="fa fa-check"></i><b>5.1.1</b> Choisir un nom</a></li>
<li class="chapter" data-level="5.1.2" data-path="package.html"><a href="package.html#créer-un-projet-rstudio-de-type-package"><i class="fa fa-check"></i><b>5.1.2</b> Créer un projet RStudio de type “package”</a></li>
<li class="chapter" data-level="5.1.3" data-path="package.html"><a href="package.html#renseigner-les-méta-données-du-package-le-fichier-description"><i class="fa fa-check"></i><b>5.1.3</b> Renseigner les méta-données du <em>package</em> : le fichier <code>DESCRIPTION</code></a></li>
<li class="chapter" data-level="" data-path="package.html"><a href="package.html#champ-license"><i class="fa fa-check"></i>Champ <code>License</code></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="package.html"><a href="package.html#configurer-les-outils-de-développement"><i class="fa fa-check"></i><b>5.2</b> Configurer les outils de développement</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="package.html"><a href="package.html#créer-un-dépôt-vide-dans-gitlab"><i class="fa fa-check"></i><b>5.2.1</b> Créer un dépôt vide dans GitLab</a></li>
<li class="chapter" data-level="5.2.2" data-path="package.html"><a href="package.html#utiliser-git-dans-le-projet-rstudio"><i class="fa fa-check"></i><b>5.2.2</b> Utiliser git dans le projet RStudio</a></li>
<li class="chapter" data-level="5.2.3" data-path="package.html"><a href="package.html#créer-le-lien-entre-le-dépôt-gitlab-et-le-projet-rstudio"><i class="fa fa-check"></i><b>5.2.3</b> Créer le lien entre le dépôt GitLab et le projet RStudio</a></li>
<li class="chapter" data-level="5.2.4" data-path="package.html"><a href="package.html#utiliser-testthat-pour-les-tests"><i class="fa fa-check"></i><b>5.2.4</b> Utiliser <code>testthat</code> pour les tests</a></li>
<li class="chapter" data-level="5.2.5" data-path="package.html"><a href="package.html#utiliser-lintégration-continue-de-gitlab"><i class="fa fa-check"></i><b>5.2.5</b> Utiliser l’intégration continue de GitLab</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="package.html"><a href="package.html#développer-un-package"><i class="fa fa-check"></i><b>5.3</b> Développer un <em>package</em></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="package.html"><a href="package.html#inclure-du-code-le-documenter-et-le-tester"><i class="fa fa-check"></i><b>5.3.1</b> Inclure du code, le documenter et le tester</a></li>
<li class="chapter" data-level="5.3.2" data-path="package.html"><a href="package.html#déclarer-une-dépendance"><i class="fa fa-check"></i><b>5.3.2</b> Déclarer une dépendance</a></li>
<li class="chapter" data-level="5.3.3" data-path="package.html"><a href="package.html#charger-lensemble-des-fonctions-de-son-package"><i class="fa fa-check"></i><b>5.3.3</b> Charger l’ensemble des fonctions de son <em>package</em></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="package.html"><a href="package.html#installer-le-package"><i class="fa fa-check"></i><b>5.4</b> Installer le <em>package</em></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="package.html"><a href="package.html#installer-sur-sa-machine"><i class="fa fa-check"></i><b>5.4.1</b> Installer sur sa machine</a></li>
<li class="chapter" data-level="5.4.2" data-path="package.html"><a href="package.html#générer-le-fichier-compressé"><i class="fa fa-check"></i><b>5.4.2</b> Générer le fichier compressé</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="package.html"><a href="package.html#documenter-un-package"><i class="fa fa-check"></i><b>5.5</b> Documenter un <em>package</em></a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="package.html"><a href="package.html#créer-un-fichier-readme-obligatoire"><i class="fa fa-check"></i><b>5.5.1</b> Créer un fichier <code>README</code> (obligatoire)</a></li>
<li class="chapter" data-level="5.5.2" data-path="package.html"><a href="package.html#créer-une-vignette-recommandé"><i class="fa fa-check"></i><b>5.5.2</b> Créer une vignette (recommandé)</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="package.html"><a href="package.html#créer-un-modèle-de-document-r-markdown"><i class="fa fa-check"></i><b>5.6</b> Créer un modèle de document R Markdown</a></li>
<li class="chapter" data-level="5.7" data-path="package.html"><a href="package.html#bonnes-pratiques"><i class="fa fa-check"></i><b>5.7</b> Bonnes pratiques</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="package.html"><a href="package.html#créer-un-changelog"><i class="fa fa-check"></i><b>5.7.1</b> Créer un changelog</a></li>
<li class="chapter" data-level="5.7.2" data-path="package.html"><a href="package.html#gérer-les-numéros-de-version"><i class="fa fa-check"></i><b>5.7.2</b> Gérer les numéros de version</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="package.html"><a href="package.html#conclusion---pour-aller-plus-loin"><i class="fa fa-check"></i><b>5.8</b> Conclusion - Pour aller plus loin</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="./">Collaboration IUT Paris-rives Seine</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Résumé des cours et TP - DU Dataviz</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="package" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapitre 5</span> Créer un <em>package</em> <code>R</code> par la pratique<a href="package.html#package" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<style type="text/css">
.red {
  color: red;
}
</style>
<div id="introduction-1" class="section level2 unnumbered hasAnchor">
<h2>Introduction<a href="package.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="pré-requis" class="section level3 unnumbered hasAnchor">
<h3>Pré-requis<a href="package.html#pré-requis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="connaissances" class="section level4 unnumbered hasAnchor">
<h4>Connaissances<a href="package.html#connaissances" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>savoir installer et utiliser des <em>packages</em>;</li>
<li>savoir créer un nouveau projet sur une forge git;</li>
<li>savoir réaliser des commits et les pousser vers la forge.</li>
</ul>
</div>
<div id="compétences" class="section level4 unnumbered hasAnchor">
<h4>Compétences<a href="package.html#compétences" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>rigueur.</li>
</ul>
</div>
<div id="configuration" class="section level4 unnumbered hasAnchor">
<h4>Configuration<a href="package.html#configuration" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Vous aurez besoin des <em>packages</em> suivants :
<strong>available</strong>,
<strong>desc</strong>,
<strong>usethis</strong> (version <code>1.5.1</code> au minimum),
<strong>gitlabr</strong> (version <code>1.1.6</code> au minimum),
<strong>git2r</strong>,
<strong>devtools</strong>,
<strong>roxygen2</strong> (version <code>6.0.0</code> au minimum),
<strong>roxygen2md</strong>,
<strong>testthat</strong>,
et <strong>covr</strong>.</p>
<p>Installez-les si besoin (vous pouvez exécuter le code ci-dessous).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="package.html#cb21-1" aria-hidden="true" tabindex="-1"></a>req_pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb21-2"><a href="package.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;available&#39;</span>, </span>
<span id="cb21-3"><a href="package.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;desc&#39;</span>, </span>
<span id="cb21-4"><a href="package.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;usethis&#39;</span>, </span>
<span id="cb21-5"><a href="package.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;gitlabr&#39;</span>,</span>
<span id="cb21-6"><a href="package.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;git2r&#39;</span>,</span>
<span id="cb21-7"><a href="package.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;devtools&#39;</span>,</span>
<span id="cb21-8"><a href="package.html#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;roxygen2&#39;</span>,</span>
<span id="cb21-9"><a href="package.html#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;roxygen2md&#39;</span>,</span>
<span id="cb21-10"><a href="package.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;testthat&#39;</span>,</span>
<span id="cb21-11"><a href="package.html#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;covr&#39;</span></span>
<span id="cb21-12"><a href="package.html#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="package.html#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="package.html#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(req_pkgs, <span class="cf">function</span>(pkg) {</span>
<span id="cb21-15"><a href="package.html#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">system.file</span>(<span class="at">package =</span> pkg) <span class="sc">==</span> <span class="st">&#39;&#39;</span>) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb21-16"><a href="package.html#cb21-16" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
</div>
<div id="brisons-quelques-mythes" class="section level3 unnumbered hasAnchor">
<h3>Brisons quelques mythes !<a href="package.html#brisons-quelques-mythes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Créer un <em>package</em> peut sembler intimidant de prime abord. En effet, on peut utiliser <code>R</code> pendant des années, utiliser des dizaines de <em>packages</em> sans avoir appris à en créer un. Dès lors, un grand nombre de mythes sont présents autour de la création de <em>packages</em>.</p>
<p>Voici quelques uns de ces mythes :</p>
<ul>
<li>créer un <em>package</em> est difficile;</li>
<li>la création de <em>packages</em> est réservée aux informaticiens;</li>
<li>il faut être un expert de <code>R</code> pour créer un <em>package</em>;</li>
<li>créer un <em>package</em> fera de moi une star;</li>
<li>…</li>
</ul>
<p>Certaines personnes se plaisent à véhiculer ces mythes. Bien évidemment, toutes ces idées sont fausses :</p>
<ul>
<li><strong>créer un <em>package</em> n’est pas difficile</strong> : il y a quelques années, c’était relativement pénible. Cependant, un grand nombre d’outils que nous allons voir et utiliser ont rendu facile la création de <em>package</em>.</li>
<li><strong>créer un <em>package</em> est pour tous</strong>. Cependant, la création d’un <em>package</em> va peut-être vous amener à vous poser des questions que vous ne vous étiez jamais posées auparavant, ou au contraire vous apporter des réponses à des questions que vous vous posiez. Étant donné que ces questions portent sur la façon dont on écrit et structure ses programmes tout en y apportant de la rigueur, vous aurez peut-être l’impression d’être en train de faire du développement informatique. Mais c’est faux : la rigueur n’est pas réservée aux informaticiens. Les statisticiens sont aussi rigoureux.</li>
<li><strong>créer un <em>package</em> ne nécessite pas d’expertise en <code>R</code></strong>. Il s’agit simplement d’une façon (très) rigoureuse d’organiser son travail.</li>
<li><strong>créer un <em>package</em> ne fera pas malheureusement pas de vous une star</strong> car comme vous allez le voir c’est quelque chose à la portée de tout le monde.</li>
</ul>
<p>Certes, la création de <em>packages</em> nécessite d’acquérir de nouvelles connaissances et de nouvelles notions, mais elles ne sont pas particulièrement complexes. De plus, ces notions sont largement transposables d’un langage de programmation à un autre, car la plupart des langages utilisent la notion de <em>packages</em> (parfois appelés librairies ou modules dans d’autres langages).</p>
<p>Un avantage de la création de <em>packages</em> est que cela va permettre de structurer vos programmes et d’y ajouter beaucoup de rigueur. La principale compétence à laquelle on fera donc appel lors de la réalisation d’un <em>package</em> est <strong>la rigueur</strong>.</p>
</div>
</div>
<div id="quand-créer-un-package" class="section level2 unnumbered hasAnchor">
<h2>Quand créer un <em>package</em> ?<a href="package.html#quand-créer-un-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Voici une règle d’or qui devrait vous guider pour savoir quand vous <strong>devez</strong> créer un <em>package</em>:</p>
<ul>
<li>lorsque vous réalisez une analyse, si vous utilisez plus de deux fois une même portion de code (que vous avez “copié-collé”), vous devez créer une fonction;</li>
<li>si vous réutilisez une fonction entre deux analyses (en “copiant-collant” le code source de cette fonction), vous devez faire un <em>package</em>.</li>
</ul>
<p>Un <em>package</em> vous permettra de réutiliser aisément des “bouts de code” entre différentes analyses et vous obligera à adopter toute la rigueur nécessaire à ce type d’exercice. Réaliser un <em>package</em> est un moyen simple de partager votre code : combien de fois avez-vous échangé des bouts de code par mail avec un collègue ? C’est précisément pour répondre à cette problématique lié au travail collaboratif que les <em>packages</em> ont été créés.</p>
<p><em><strong>Question</strong> : si je n’ai qu’une seule fonction que je souhaite réutiliser entre plusieurs analyses ou partager avec un collègue, est-il nécessaire de créer un <em>package</em> ?</em><br />
Oui, c’est même fortement recommandé. Il est très facile de créer un <em>package</em> qui ne comprend qu’une seule fonction. Cela ne prend pas beaucoup de temps et structurera votre travail.</p>
<p><strong>Créer un <em>package</em> doit donc devenir une habitude de travail et une bonne pratique</strong>. En cas de doute ou d’oubli, vous pouvez toujours retourner consulter le petit livre rouge des <em>packages</em> <code>R</code> <span class="citation">(<a href="#ref-wickham2015r" role="doc-biblioref">Wickham 2015</a>)</span>.</p>
<div id="le-concept-de-package" class="section level3 unnumbered hasAnchor">
<h3>Le concept de <em>package</em><a href="package.html#le-concept-de-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dans cette partie, nous introduisons la notion de <em>package</em>.</p>
<div id="exportation-et-importation" class="section level4 unnumbered hasAnchor">
<h4>Exportation et importation<a href="package.html#exportation-et-importation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Un <em>package</em> offre des fonctions prêtes à l’emploi. Ces fonctions sont disponibles après un appel à <code>library()</code> ou bien en utilisant <code>::</code>. Ces fonctions “prêtes à l’emploi” sont des fonctions dites <strong>exportées</strong> par le <em>package</em>. Cette notion est à distinguer des fonctions <strong>internes</strong> à un <em>package</em> auxquelles l’utilisateur ne peut accéder.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> C’est le créateur du <em>package</em> qui décide des fonctions qu’il souhaite exporter ou bien conserver pour une utilisation interne sachant que l’utilisateur extérieur ne pourra accéder qu’aux fonctions exportées</p>
<p>On peut se représenter un <em>package</em> comme un ensemble clos qui par défaut n’a aucun échange avec l’extérieur. Pour qu’une fonction du <em>package</em> soit disponible pour un utilisateur, il faut que le créateur du <em>package</em> décide de l’exporter. De façon symétrique, lorsque vous créez un <em>package</em>, si vous souhaitez utiliser une fonction d’un autre <em>package</em>, vous allez devoir le préciser. Il s’agit d’un mécanisme nommé <strong>importation</strong>.</p>
<p>Cette notion (exportation et importation) est le principal concept nouveau. Il peut paraître relativement abstrait au début. Retenez que par défaut, un <em>package</em> est isolé du monde extérieur : il n’exporte aucune fonction et n’en importe aucune. Ce sera à vous de décider et de préciser quelles fonctions seront exportées par votre <em>package</em> et quelles fonctions devront être importées pour que votre code puisse fonctionner.</p>
</div>
<div id="check" class="section level4 unnumbered hasAnchor">
<h4>Contrôle de conformité<a href="package.html#check" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Un <em>package</em> doit répondre à un ensemble de <strong>normes</strong>. L’objectif de la formation n’est pas d’apprendre l’ensemble de ces normes qui sont décrites dans le manuel officiel de <code>R</code> <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html"><em>Writing <code>R</code> Extensions</em></a>.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<p>En effet, nous utiliserons un ensemble d’outils (principalement les <em>packages</em> <strong>devtools</strong> et <strong>usethis</strong>) qui nous permettront de gérer correctement la création d’un <em>package</em>. Cependant, nous contrôlerons en permanence que notre <em>package</em> est conforme aux normes attendues par <code>R</code> en effectuant <strong>des contrôles de conformité</strong>.</p>
<p>Dans le jargon <code>R</code>, un contrôle de conformité s’appelle un <strong>check</strong>. Cette étape est <strong>fondamentale</strong>. <strong>Vous ne devrez jamais la négliger.</strong></p>
<p>Il s’agit de passer une batterie de contrôles pour voir si les modifications que vous opérez à votre <em>package</em> sont conformes :</p>
<ul>
<li>aux normes exigées par <code>R</code>;</li>
<li>aux tests que vous aurez vous-mêmes définis.</li>
</ul>
<p>Il s’agit de l’action que vous réaliserez le plus fréquemment. Si vous négligiez de le faire, vous pourriez à terme vous retrouver dans des situations très délicates. Il y a trois façons de réaliser ce contrôle de conformité :</p>
<ul>
<li><p>dans l’onglet <em>Build</em>, cliquer sur le bouton <em>Check</em>;</p></li>
<li><p>utiliser le raccourci clavier <code>Ctrl+Shift+E</code>;</p></li>
<li><p>dans la console de R, exécuter :</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="package.html#cb22-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span></code></pre></div></li>
</ul>
<p><strong>Il s’agit de l’étape la plus importante</strong>.<br />
Notez-là dès maintenant, car vous allez l’utiliser très souvent.</p>
</div>
</div>
<div id="feuille-de-route-pour-créer-un-package" class="section level3 unnumbered hasAnchor">
<h3>Feuille de route pour créer un <em>package</em><a href="package.html#feuille-de-route-pour-créer-un-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Comme la création de <em>package</em> est une pratique très courante, il existe des <em>packages</em> pour nous assister dans la création de <em>packages</em>… Nous pourrions évidemment tout créer à la main, mais cela ne présente pas d’intérêt particulier à part celui de nous faire perdre du temps avec des tâches à faible valeur ajoutée.</p>
<p>Voici la feuille de route pour créer un <em>package</em> :</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="package.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Initier un package -------------------------------------</span></span>
<span id="cb23-2"><a href="package.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Étapes à ne faire qu&#39;une seule fois</span></span>
<span id="cb23-3"><a href="package.html#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="package.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.a. Choisir un nom</span></span>
<span id="cb23-5"><a href="package.html#cb23-5" aria-hidden="true" tabindex="-1"></a>nom <span class="ot">&lt;-</span> <span class="st">&quot;monpetitpaquet&quot;</span></span>
<span id="cb23-6"><a href="package.html#cb23-6" aria-hidden="true" tabindex="-1"></a>available<span class="sc">::</span><span class="fu">available</span>(nom, <span class="at">browse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-7"><a href="package.html#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="package.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.b. Créer un projet RStudio de type &quot;package&quot;</span></span>
<span id="cb23-9"><a href="package.html#cb23-9" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="fu">file.path</span>(<span class="st">&quot;~&quot;</span>, nom))</span>
<span id="cb23-10"><a href="package.html#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="package.html#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.c. Renseigner les méta-données du package</span></span>
<span id="cb23-12"><a href="package.html#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Titre du package</span></span>
<span id="cb23-13"><a href="package.html#cb23-13" aria-hidden="true" tabindex="-1"></a>desc<span class="sc">::</span><span class="fu">desc_set</span>(</span>
<span id="cb23-14"><a href="package.html#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Title =</span> <span class="st">&quot;Mon Premier Paquet&quot;</span></span>
<span id="cb23-15"><a href="package.html#cb23-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-16"><a href="package.html#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Désigner les auteurs, contributeurs et </span></span>
<span id="cb23-17"><a href="package.html#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co"># les détenteurs des droits de propriété intellectuelle</span></span>
<span id="cb23-18"><a href="package.html#cb23-18" aria-hidden="true" tabindex="-1"></a>desc<span class="sc">::</span><span class="fu">desc_set_authors</span>(<span class="fu">c</span>(</span>
<span id="cb23-19"><a href="package.html#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">person</span>(</span>
<span id="cb23-20"><a href="package.html#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Mon prénom&quot;</span>, </span>
<span id="cb23-21"><a href="package.html#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Mon nom&quot;</span>, </span>
<span id="cb23-22"><a href="package.html#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">role =</span> <span class="fu">c</span>(<span class="st">&quot;aut&quot;</span>, <span class="st">&quot;cre&quot;</span>), </span>
<span id="cb23-23"><a href="package.html#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">email =</span> <span class="st">&quot;monprenom.monnom@insee.fr&quot;</span></span>
<span id="cb23-24"><a href="package.html#cb23-24" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-25"><a href="package.html#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">person</span>(</span>
<span id="cb23-26"><a href="package.html#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;Institut national de la statistique et des études économiques&quot;</span>, </span>
<span id="cb23-27"><a href="package.html#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">role =</span> <span class="st">&quot;cph&quot;</span></span>
<span id="cb23-28"><a href="package.html#cb23-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-29"><a href="package.html#cb23-29" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb23-30"><a href="package.html#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Décrire ce que fait le package</span></span>
<span id="cb23-31"><a href="package.html#cb23-31" aria-hidden="true" tabindex="-1"></a>desc<span class="sc">::</span><span class="fu">desc_set</span>(</span>
<span id="cb23-32"><a href="package.html#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="st">&quot;J&#39;ai créé ce package pour apprendre. Ne l&#39;installez pas il ne fait rien d&#39;intéressant pour l&#39;instant.&quot;</span></span>
<span id="cb23-33"><a href="package.html#cb23-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-34"><a href="package.html#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Choisir une licence </span></span>
<span id="cb23-35"><a href="package.html#cb23-35" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_mit_license</span>(</span>
<span id="cb23-36"><a href="package.html#cb23-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;Institut national de la statistique et des études économiques (Insee)&quot;</span></span>
<span id="cb23-37"><a href="package.html#cb23-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-38"><a href="package.html#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Si la documentation du package est en français</span></span>
<span id="cb23-39"><a href="package.html#cb23-39" aria-hidden="true" tabindex="-1"></a>desc<span class="sc">::</span><span class="fu">desc_set</span>(<span class="at">Language =</span> <span class="st">&quot;fr&quot;</span>)</span>
<span id="cb23-40"><a href="package.html#cb23-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-41"><a href="package.html#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Configurer les outils de développement -----------------</span></span>
<span id="cb23-42"><a href="package.html#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Étapes à ne faire qu&#39;une seule fois</span></span>
<span id="cb23-43"><a href="package.html#cb23-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-44"><a href="package.html#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.a. Créer un dépôt vide dans GitLab</span></span>
<span id="cb23-45"><a href="package.html#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="co"># il est possible d&#39;automatiser cette étape, voir le support de formation</span></span>
<span id="cb23-46"><a href="package.html#cb23-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-47"><a href="package.html#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.b. Utiliser git dans le projet RStudio</span></span>
<span id="cb23-48"><a href="package.html#cb23-48" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_git</span>()</span>
<span id="cb23-49"><a href="package.html#cb23-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-50"><a href="package.html#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.c. Créer le lien entre le dépôt GitLab </span></span>
<span id="cb23-51"><a href="package.html#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="co"># et le projet RStudio</span></span>
<span id="cb23-52"><a href="package.html#cb23-52" aria-hidden="true" tabindex="-1"></a>repo_url <span class="ot">&lt;-</span> <span class="st">&quot;https://gitlab.com/RLesur/monpetitpaquet.git&quot;</span></span>
<span id="cb23-53"><a href="package.html#cb23-53" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_git_remote</span>(<span class="at">url =</span> repo_url)</span>
<span id="cb23-54"><a href="package.html#cb23-54" aria-hidden="true" tabindex="-1"></a>git2r<span class="sc">::</span><span class="fu">push</span>(<span class="at">name =</span> <span class="st">&quot;origin&quot;</span>, </span>
<span id="cb23-55"><a href="package.html#cb23-55" aria-hidden="true" tabindex="-1"></a>            <span class="at">refspec =</span> <span class="st">&quot;refs/heads/master&quot;</span>, </span>
<span id="cb23-56"><a href="package.html#cb23-56" aria-hidden="true" tabindex="-1"></a>            <span class="at">set_upstream =</span> <span class="cn">TRUE</span></span>
<span id="cb23-57"><a href="package.html#cb23-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-58"><a href="package.html#cb23-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-59"><a href="package.html#cb23-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.d. Utiliser testthat pour les tests</span></span>
<span id="cb23-60"><a href="package.html#cb23-60" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_testthat</span>()</span>
<span id="cb23-61"><a href="package.html#cb23-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-62"><a href="package.html#cb23-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.e. Utiliser l&#39;intégration continue de GitLab</span></span>
<span id="cb23-63"><a href="package.html#cb23-63" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_gitlab_ci</span>()</span>
<span id="cb23-64"><a href="package.html#cb23-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-65"><a href="package.html#cb23-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.f. Pour utiliser markdown dans la documentation</span></span>
<span id="cb23-66"><a href="package.html#cb23-66" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_roxygen_md</span>()</span>
<span id="cb23-67"><a href="package.html#cb23-67" aria-hidden="true" tabindex="-1"></a>roxygen2md<span class="sc">::</span><span class="fu">roxygen2md</span>()</span>
<span id="cb23-68"><a href="package.html#cb23-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-69"><a href="package.html#cb23-69" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Développer un package ----------------------------------</span></span>
<span id="cb23-70"><a href="package.html#cb23-70" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.a. Inclure du code, le documenter et le tester</span></span>
<span id="cb23-71"><a href="package.html#cb23-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour chaque fonction du package :</span></span>
<span id="cb23-72"><a href="package.html#cb23-72" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">&quot;mafonction&quot;</span>)</span>
<span id="cb23-73"><a href="package.html#cb23-73" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">&quot;mafonction&quot;</span>)</span>
<span id="cb23-74"><a href="package.html#cb23-74" aria-hidden="true" tabindex="-1"></a><span class="co"># écrire le code de la fonction</span></span>
<span id="cb23-75"><a href="package.html#cb23-75" aria-hidden="true" tabindex="-1"></a><span class="co"># documenter la fonction</span></span>
<span id="cb23-76"><a href="package.html#cb23-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Actualiser le NAMESPACE et la documentation</span></span>
<span id="cb23-77"><a href="package.html#cb23-77" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span>
<span id="cb23-78"><a href="package.html#cb23-78" aria-hidden="true" tabindex="-1"></a><span class="co"># écrire les tests</span></span>
<span id="cb23-79"><a href="package.html#cb23-79" aria-hidden="true" tabindex="-1"></a><span class="co"># exécuter les tests</span></span>
<span id="cb23-80"><a href="package.html#cb23-80" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">test</span>()</span>
<span id="cb23-81"><a href="package.html#cb23-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-82"><a href="package.html#cb23-82" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.b. Si besoin, déclarer une dépendance</span></span>
<span id="cb23-83"><a href="package.html#cb23-83" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="at">min_version =</span> <span class="st">&quot;0.8&quot;</span>)</span>
<span id="cb23-84"><a href="package.html#cb23-84" aria-hidden="true" tabindex="-1"></a><span class="co"># pour utiliser %&gt;% dans un package</span></span>
<span id="cb23-85"><a href="package.html#cb23-85" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_pipe</span>()</span>
<span id="cb23-86"><a href="package.html#cb23-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-87"><a href="package.html#cb23-87" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.c. Astuce qui peut aider durant le développement</span></span>
<span id="cb23-88"><a href="package.html#cb23-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Charger l&#39;ensemble des fonctions de son package</span></span>
<span id="cb23-89"><a href="package.html#cb23-89" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>()</span>
<span id="cb23-90"><a href="package.html#cb23-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-91"><a href="package.html#cb23-91" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.d. Assurer la conformité du package</span></span>
<span id="cb23-92"><a href="package.html#cb23-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Réaliser le contrôle de conformité</span></span>
<span id="cb23-93"><a href="package.html#cb23-93" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span>
<span id="cb23-94"><a href="package.html#cb23-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-95"><a href="package.html#cb23-95" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Installer le package -----------------------------------</span></span>
<span id="cb23-96"><a href="package.html#cb23-96" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.a. Sur sa machine</span></span>
<span id="cb23-97"><a href="package.html#cb23-97" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install</span>()</span>
<span id="cb23-98"><a href="package.html#cb23-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-99"><a href="package.html#cb23-99" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.b. Générer le fichier compressé</span></span>
<span id="cb23-100"><a href="package.html#cb23-100" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">build</span>()</span>
<span id="cb23-101"><a href="package.html#cb23-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-102"><a href="package.html#cb23-102" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Documenter un package ----------------------------------</span></span>
<span id="cb23-103"><a href="package.html#cb23-103" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.a. Créer un README (obligatoire)</span></span>
<span id="cb23-104"><a href="package.html#cb23-104" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_readme_rmd</span>() <span class="co"># ou bien usethis::use_readme_md()</span></span>
<span id="cb23-105"><a href="package.html#cb23-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-106"><a href="package.html#cb23-106" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.b. Créer une vignette (fortement recommandé)</span></span>
<span id="cb23-107"><a href="package.html#cb23-107" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_vignette</span>(nom)</span>
<span id="cb23-108"><a href="package.html#cb23-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecrire au moins une vignette qui explique </span></span>
<span id="cb23-109"><a href="package.html#cb23-109" aria-hidden="true" tabindex="-1"></a><span class="co"># comment on utilise le package</span></span>
<span id="cb23-110"><a href="package.html#cb23-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour construire les vignettes</span></span>
<span id="cb23-111"><a href="package.html#cb23-111" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">build_vignettes</span>()</span>
<span id="cb23-112"><a href="package.html#cb23-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-113"><a href="package.html#cb23-113" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Si besoin, créer un modèle de rapport R Markdown -------</span></span>
<span id="cb23-114"><a href="package.html#cb23-114" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_rmarkdown_template</span>(<span class="st">&quot;note mensuelle&quot;</span>)</span>
<span id="cb23-115"><a href="package.html#cb23-115" aria-hidden="true" tabindex="-1"></a><span class="co"># éditer le fichier </span></span>
<span id="cb23-116"><a href="package.html#cb23-116" aria-hidden="true" tabindex="-1"></a><span class="co"># inst/rmarkdown/templates/note-mensuelle/skeleton/skeleton.Rmd</span></span>
<span id="cb23-117"><a href="package.html#cb23-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-118"><a href="package.html#cb23-118" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Bonnes pratiques ---------------------------------------</span></span>
<span id="cb23-119"><a href="package.html#cb23-119" aria-hidden="true" tabindex="-1"></a><span class="co"># 7.a Créer un changelog (à ne faire qu&#39;une fois)</span></span>
<span id="cb23-120"><a href="package.html#cb23-120" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_news_md</span>()</span>
<span id="cb23-121"><a href="package.html#cb23-121" aria-hidden="true" tabindex="-1"></a><span class="co"># 7.b. Gérer les versions</span></span>
<span id="cb23-122"><a href="package.html#cb23-122" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_version</span>(<span class="st">&quot;dev&quot;</span>)</span>
<span id="cb23-123"><a href="package.html#cb23-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-124"><a href="package.html#cb23-124" aria-hidden="true" tabindex="-1"></a><span class="co"># 7.c. Améliorer les tests et la couverture de code</span></span>
<span id="cb23-125"><a href="package.html#cb23-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Si vous avez bien effectué l&#39;étape 2.e, </span></span>
<span id="cb23-126"><a href="package.html#cb23-126" aria-hidden="true" tabindex="-1"></a><span class="co"># le rapport de couverture de code est disponible </span></span>
<span id="cb23-127"><a href="package.html#cb23-127" aria-hidden="true" tabindex="-1"></a><span class="co"># dans GitLab Pages</span></span>
<span id="cb23-128"><a href="package.html#cb23-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Viser une couverture de code de 100%</span></span></code></pre></div>
<div id="démonstration-par-les-formateurs-créer-un-package-en-moins-de-10-minutes" class="section level4 unnumbered hasAnchor">
<h4>Démonstration par les formateurs : créer un <em>package</em> en moins de 10 minutes<a href="package.html#démonstration-par-les-formateurs-créer-un-package-en-moins-de-10-minutes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Afin de démystifier la création de <em>package</em>, nous demandons aux formateurs de réaliser une première démonstration devant les stagiaires. Cette démonstration doit prendre le moins de temps possible, entre 5 et 10 minutes.</p>
<p>Vous utiliserez le déroulé précédent (voir ci-dessus). Effectuez les étapes 1 à 4.a suivies de l’étape 6.a (vous adapterez l’url du serveur GitLab et éventuellement le nom du <em>package</em>). Vous créerez une fonction simple de votre choix et écrirez également un test. Vous pouvez utiliser l’interface RStudio pour réaliser certaines étapes plus aisément si vous le souhaitez. Mais l’objectif est de réaliser rapidement un <em>package</em> avec une fonction documentée.</p>
<p>Une fois le <em>package</em> installé, vous exécuterez la fonction créée et montrerez la page d’aide de la fonction.</p>
<p>Vous pousserez également votre travail sur GitLab et montrerez le rapport de couverture de code accessible sur GitLab Pages.</p>
</div>
<div id="comment-lire-ce-document" class="section level4 unnumbered hasAnchor">
<h4>Comment lire ce document ?<a href="package.html#comment-lire-ce-document" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Le document détaille chaque étape de la feuille de route. Vous pouvez le lire dans l’ordre successif où aller directement à la partie qui vous intéresse.</p>
<p>L’objectif de la formation n’est pas de dispenser toutes les informations comprises dans ce document (cela ferait trop). Ce document est une aide pour les formateurs et les stagiaires pour trouver des réponses à des questions qui se posent en pratique.</p>
</div>
<div id="exercice-pratique" class="section level4 unnumbered hasAnchor">
<h4>Exercice pratique<a href="package.html#exercice-pratique" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TODO : à définir</p>
<p>Une idée (à discuter dans le groupe de conception) serait d’intégrer le travail fait en RMarkdown dans un template puis de basculer certaines fonctions dans le code source du <em>package</em>.</p>
</div>
</div>
</div>
<div id="initier-un-package" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Initier un <em>package</em><a href="package.html#initier-un-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="choisir-un-nom" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Choisir un nom<a href="package.html#choisir-un-nom" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>C’est sans doute l’étape la plus délicate. <strong>Il faut trouver un nouveau nom de <em>package</em> qui est disponible</strong>. En effet, si vous aviez l’idée de créer un nouveau <em>package</em> avec le nom <code>dplyr</code> et que vous l’installiez, vous écraseriez le <em>package</em> <code>dplyr</code> que vous utilisez régulièrement.</p>
<p>Sachant qu’il existe plusieurs milliers de <em>packages</em> sur le CRAN, Bioconductor<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> et GitHub, cette vérification pourrait être fastidieuse. Cependant, Jim Hester a créé le <em>package</em> <strong>available</strong> pour vous assister dans cette vérification.</p>
<p>Les principales fonctions du <em>package</em> <strong>available</strong> sont <code>available_on_cran()</code>, <code>available_on_bioc()</code> et <code>available_on_github()</code>. Par exemple, pour vérifier si le nom de <em>package</em> <code>dplyr</code> est disponible, exécutez :</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="package.html#cb24-1" aria-hidden="true" tabindex="-1"></a>available<span class="sc">::</span><span class="fu">available_on_cran</span>(<span class="st">&#39;dplyr&#39;</span>)</span></code></pre></div>
<pre><code>## Available on CRAN: ✖</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="package.html#cb26-1" aria-hidden="true" tabindex="-1"></a>available<span class="sc">::</span><span class="fu">available_on_bioc</span>(<span class="st">&#39;dplyr&#39;</span>)</span></code></pre></div>
<pre><code>## Available on Bioconductor: ✔</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="package.html#cb28-1" aria-hidden="true" tabindex="-1"></a>available<span class="sc">::</span><span class="fu">available_on_github</span>(<span class="st">&#39;dplyr&#39;</span>)</span></code></pre></div>
<pre><code>## Available on GitHub:  ✖</code></pre>
<p>Vous ne devez <strong>jamais choisir</strong> comme nom de <em>package</em> un nom qui est déjà utilisé sur le <strong>CRAN</strong>.</p>
<p>Si votre <em>package</em> a vocation à être rendu public, vous ne devez <strong>jamais choisir</strong> un nom de <em>package</em> qui ne serait pas disponible sur <strong>Bioconductor</strong>. Dans le cas d’un <em>package</em> interne à l’Insee, cela n’est pas recommandé non plus (les <em>packages</em> de Bioconductor étant principalement dédié à la bioinformatique, il est cependant peu probable que cela pose un problème au sein de l’Insee).</p>
<p>Si vous constatez que le nom n’est pas disponible sur GitHub, il est préférable également de trouver un autre nom pour éviter toute difficulté aux utilisateurs qui souhaiteraient tester votre <em>package</em> ainsi que l’autre en cours de développement.</p>
<p>Vous pouvez obtenir les adresses des projets ayant un nom identique ou proche sur GitHub de la façon suivante :</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="package.html#cb30-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> available<span class="sc">::</span><span class="fu">available_on_github</span>(<span class="st">&#39;dplyr&#39;</span>)</span>
<span id="cb30-2"><a href="package.html#cb30-2" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>close[[<span class="dv">1</span>]]<span class="sc">$</span>url</span></code></pre></div>
<pre><code>## [1] &quot;https://github.com/YTLogos/dplyr&quot;      
## [2] &quot;https://github.com/hadley/dplyr&quot;       
## [3] &quot;https://github.com/tidyverse/dplyr&quot;    
## [4] &quot;https://github.com/akgold/dply2&quot;       
## [5] &quot;https://github.com/asardaes/dtplyr&quot;    
## [6] &quot;https://github.com/epix-project/dplyrx&quot;</code></pre>
<p>Imaginons que nous envisagions d’appeler notre <em>package</em> <code>monpetitpaquet</code>. Vérifiez que le nom est bien disponible.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="package.html#cb32-1" aria-hidden="true" tabindex="-1"></a>available<span class="sc">::</span><span class="fu">available_on_cran</span>(<span class="st">&#39;monpetitpaquet&#39;</span>)</span></code></pre></div>
<pre><code>## Available on CRAN: ✔</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="package.html#cb34-1" aria-hidden="true" tabindex="-1"></a>available<span class="sc">::</span><span class="fu">available_on_bioc</span>(<span class="st">&#39;monpetitpaquet&#39;</span>)</span></code></pre></div>
<pre><code>## Available on Bioconductor: ✔</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="package.html#cb36-1" aria-hidden="true" tabindex="-1"></a>available<span class="sc">::</span><span class="fu">available_on_github</span>(<span class="st">&#39;monpetitpaquet&#39;</span>)</span></code></pre></div>
<pre><code>## Available on GitHub:  ✔</code></pre>
<div id="pour-aller-plus-loin" class="section level4 unnumbered hasAnchor">
<h4>Pour aller plus loin<a href="package.html#pour-aller-plus-loin" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TODO Préciser les règles de nommage (caractères autorisés) et les recommandations (minuscules, pas de point).<br />
Extrait de la documentation de <code>R</code> :</p>
<blockquote>
<p>This should contain only (ASCII) letters, numbers and dot, have at least two characters and start with a letter and not end in a dot.</p>
</blockquote>
</div>
</div>
<div id="créer-un-projet-rstudio-de-type-package" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Créer un projet RStudio de type “package”<a href="package.html#créer-un-projet-rstudio-de-type-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Nous allons créer le projet à la racine de votre répertoire personnel (<code>~</code>).<br />
Evidemment, vous pouvez le créer à un autre emplacement mais celui-ci est généralement sans risque.<br />
Si nous voulons créer un <em>package</em> s’appelant <code>monpetitpaquet</code>, nous allons exécuter :</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="package.html#cb38-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="fu">file.path</span>(<span class="st">&quot;~&quot;</span> , <span class="st">&quot;monpetitpaquet&quot;</span>))</span></code></pre></div>
<p>Un message de ce type va apparaître :</p>
<pre><code>✔ Creating &#39;/home/romain/monpetitpaquet/&#39;
✔ Setting active project to &#39;/home/romain/monpetitpaquet&#39;
✔ Creating &#39;R/&#39;
✔ Writing &#39;DESCRIPTION&#39;
Package: monpetitpaquet
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R (parsed):
    * First Last &lt;first.last@example.com&gt; [aut, cre] (&lt;https://orcid.org/YOUR-ORCID-ID&gt;)
Description: What the package does (one paragraph).
License: What license it uses
Encoding: UTF-8
LazyData: true
✔ Writing &#39;NAMESPACE&#39;
✔ Writing &#39;monpetitpaquet.Rproj&#39;
✔ Adding &#39;.Rproj.user&#39; to &#39;.gitignore&#39;
✔ Adding &#39;^monpetitpaquet\\.Rproj$&#39;, &#39;^\\.Rproj\\.user$&#39; to &#39;.Rbuildignore&#39;
✔ Opening &#39;/home/romain/monpetitpaquet/&#39; in new RStudio session
✔ Setting active project to &#39;&lt;no active project&gt;&#39;</code></pre>
<p>Vous devriez voir RStudio ouvrir le projet <code>monpetitpaquet</code>.</p>
<p><strong>Ca y est, vous avez créé la structure de votre <em>package</em></strong>.</p>
<p>Comme vous le voyez, ce n’était pas très compliqué…</p>
<div id="contrôle-de-conformité" class="section level4 unnumbered hasAnchor">
<h4>Contrôle de conformité<a href="package.html#contrôle-de-conformité" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Le contrôle de conformité doit devenir une habitude. Vous devez effectuer ce contrôle après chaque modification substantielle. Nous allons donc effectuer un premier contrôle de conformité de notre <em>package</em>. Si besoin, <a href="package.html#check">relisez ce qu’est un contrôle de conformité</a>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="package.html#cb40-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span></code></pre></div>
<pre><code>## Updating monpetitpaquet documentation
## Loading monpetitpaquet
## Setting env vars ---------------------------------------------------------------------------------------------------------------
## CFLAGS  : -Wall -pedantic
## CXXFLAGS: -Wall -pedantic
## Building monpetitpaquet --------------------------------------------------------------------------------------------------------
## &#39;/usr/lib/R/bin/R&#39; --no-site-file --no-environ --no-save --no-restore --quiet CMD build &#39;/home/romain/monpetitpaquet&#39;  
##   --no-resave-data --no-manual 
## 
## * checking for file ‘/home/romain/monpetitpaquet/DESCRIPTION’ ... OK
## * preparing ‘monpetitpaquet’:
## * checking DESCRIPTION meta-information ... OK
## * checking for LF line-endings in source and make files and shell scripts
## * checking for empty or unneeded directories
## Removed empty directory ‘monpetitpaquet/R’
## Removed empty directory ‘monpetitpaquet/man’
## * building ‘monpetitpaquet_0.0.0.9000.tar.gz’
## 
## Setting env vars ---------------------------------------------------------------------------------------------------------------
## _R_CHECK_CRAN_INCOMING_USE_ASPELL_: TRUE
## _R_CHECK_CRAN_INCOMING_           : FALSE
## _R_CHECK_FORCE_SUGGESTS_          : FALSE
## Checking monpetitpaquet --------------------------------------------------------------------------------------------------------
## &#39;/usr/lib/R/bin/R&#39; --no-site-file --no-environ --no-save --no-restore --quiet CMD check  
##   &#39;/tmp/Rtmp49wyMM/monpetitpaquet_0.0.0.9000.tar.gz&#39; --as-cran --timings --no-manual 
## 
## * using log directory ‘/tmp/Rtmp49wyMM/monpetitpaquet.Rcheck’
## * using R version 3.4.4 (2018-03-15)
## * using platform: x86_64-pc-linux-gnu (64-bit)
## * using session charset: UTF-8
## * using options ‘--no-manual --as-cran’
## * checking for file ‘monpetitpaquet/DESCRIPTION’ ... OK
## * this is package ‘monpetitpaquet’ version ‘0.0.0.9000’
## * package encoding: UTF-8
## * checking package namespace information ... OK
## * checking package dependencies ... OK
## * checking if this is a source package ... OK
## * checking if there is a namespace ... OK
## * checking for executable files ... OK
## * checking for hidden files and directories ... OK
## * checking for portable file names ... OK
## * checking for sufficient/correct file permissions ... OK
## * checking whether package ‘monpetitpaquet’ can be installed ... OK
## * checking installed package size ... OK
## * checking package directory ... OK
## * checking DESCRIPTION meta-information ... WARNING
## Non-standard license specification:
##   What license it uses
## Standardizable: FALSE
## * checking top-level files ... OK
## * checking for left-over files ... OK
## * checking index information ... OK
## * checking package subdirectories ... OK
## * checking whether the package can be loaded ... OK
## * checking whether the package can be loaded with stated dependencies ... OK
## * checking whether the package can be unloaded cleanly ... OK
## * checking whether the namespace can be loaded with stated dependencies ... OK
## * checking whether the namespace can be unloaded cleanly ... OK
## * checking loading without being on the library search path ... OK
## * checking examples ... NONE
## * DONE
## 
## Status: 1 WARNING
## See
##   ‘/tmp/Rtmp49wyMM/monpetitpaquet.Rcheck/00check.log’
## for details.
## 
## 
## R CMD check results
## 0 errors | 1 warning  | 0 notes
## checking DESCRIPTION meta-information ... WARNING
## Non-standard license specification:
##   What license it uses
## Standardizable: FALSE</code></pre>
<p>La longueur de ce rapport peut paraître assez effrayante au premier abord (surtout pour une action que vous allez répéter très fréquemment). Il n’est pas si complexe à lire si on commence par la fin (la synthèse) :</p>
<pre><code>R CMD check results
0 errors | 1 warning  | 0 notes
checking DESCRIPTION meta-information ... WARNING
Non-standard license specification:
  What license it uses
Standardizable: FALSE</code></pre>
<p>La ligne la plus importante est la suivante :</p>
<pre><code>0 errors | 1 warning  | 0 notes</code></pre>
<p>Lorsque vous avez 0 erreur, 0 avertissement et 0 note, c’est bon, vous pouvez continuer de travailler.</p>
<p>Sinon, il va falloir résoudre ces problèmes. <strong>Ne remettez jamais à plus tard la résolution des erreurs, warnings et notes.</strong></p>
<p>Dans notre cas, nous n’avons rien fait et nous avons déjà un avertissement. Cela pourrait paraître très étrange. Cependant, il nous suffit de lire la nature du warning :</p>
<pre><code>checking DESCRIPTION meta-information ... WARNING
Non-standard license specification:
  What license it uses</code></pre>
<p>L’avertissement que nous obtenons concerne la licence de notre <em>package</em>, méta-donnée déclarée dans un fichier qui se nomme <code>DESCRIPTION</code> et qui se trouve à la racine de notre projet.</p>
<p>Nous allons aborder dans la partie suivante le contenu de ce fichier.</p>
</div>
</div>
<div id="renseigner-les-méta-données-du-package-le-fichier-description" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Renseigner les méta-données du <em>package</em> : le fichier <code>DESCRIPTION</code><a href="package.html#renseigner-les-méta-données-du-package-le-fichier-description" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Un <em>package</em> comprend un certain nombre de méta-données. Celles-ci sont fondamentales. Elles sont toutes précisées dans un fichier nommé <code>DESCRIPTION</code> situé à la racine du projet.</p>
<p><strong>Ouvrez le fichier <code>DESCRIPTION</code></strong>.</p>
<p>Il devrait avoir ce contenu :</p>
<pre><code>Package: monpetitpaquet
Title: What the *package* Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R: 
    person(given = &quot;First&quot;,
           family = &quot;Last&quot;,
           role = c(&quot;aut&quot;, &quot;cre&quot;),
           email = &quot;first.last@example.com&quot;,
           comment = c(ORCID = &quot;YOUR-ORCID-ID&quot;))
Description: What the package does (one paragraph).
License: What license it uses
Encoding: UTF-8
LazyData: true</code></pre>
<p>Nous allons passer en revue les différentes méta-données et les modifier si besoin.</p>
<div id="champ-package" class="section level4 unnumbered hasAnchor">
<h4>Champ <code>Package</code><a href="package.html#champ-package" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>C’est le nom de votre <em>package</em>. Normalement, <strong>vous n’avez pas besoin de le modifier</strong>.</p>
</div>
<div id="champ-title" class="section level4 unnumbered hasAnchor">
<h4>Champ <code>Title</code><a href="package.html#champ-title" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Vous devez modifier ce champ</strong> pour donner un titre à votre <em>package</em>. Pour être publié sur le CRAN, il est exigé un titre formaté avec des majuscules (sauf conjonctions).</p>
<p>Vous pouvez modifier le fichier <code>DESCRIPTION</code> à la main ou bien utiliser le <em>package</em> <strong>desc</strong> comme suit :</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="package.html#cb46-1" aria-hidden="true" tabindex="-1"></a>desc<span class="sc">::</span><span class="fu">desc_set</span>(<span class="at">Title =</span> <span class="st">&quot;Mon Premier Paquet&quot;</span>)</span></code></pre></div>
</div>
<div id="champ-version" class="section level4 unnumbered hasAnchor">
<h4>Champ <code>Version</code><a href="package.html#champ-version" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Le numéro de version de votre <em>package</em>. Vous le changerez régulièrement. <strong>Ne le modifiez pas maintenant</strong>. Nous verrons cela dans la partie consacrée à la gestion des versions.</p>
</div>
<div id="champ-authorsr" class="section level4 unnumbered hasAnchor">
<h4>Champ <code>Authors@R</code><a href="package.html#champ-authorsr" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Vous devez modifier ce champ</strong> pour indiquer les personnes qui ont créé le <em>package</em>, la personne en charge de sa maintenance et les personnes ou organismes qui possèdent des droits de propriété intellectuelle sur le code source.</p>
<p>Voici un exemple :</p>
<pre><code>Authors@R: c(
  person(&quot;Prénom du mainteneur&quot;, &quot;Nom du mainteneur&quot;, role = &quot;cre&quot;, email = &quot;prenom.nom@insee.fr&quot;),
  person(&quot;Prénom d&#39;un auteur&quot;, &quot;Nom d&#39;un auteur&quot;, role = &quot;aut&quot;),
  person(&quot;Prénom d&#39;un second auteur&quot;, &quot;Nom d&#39;un second auteur&quot;, role = &quot;aut&quot;),
  person(&quot;Prénom d&#39;un contributeur&quot;, &quot;Nom d&#39;un contributeur&quot;, role = &quot;ctb&quot;),
  person(family = &quot;Institut national de la statistique et des études économiques&quot;, role = &quot;cph&quot;)
  )</code></pre>
<p>Quelques détails sur le champ <code>role</code> :</p>
<ul>
<li><p><strong><code>"cre"</code></strong> fait référence à la personne en charge de la maintenance du <em>package</em>. Il s’agit de la personne à qui l’on doit s’adresser si on détecte un bug, par exemple ; son adresse mail est obligatoire. Ce n’est pas nécessairement la personne qui a créé le <em>package</em> mais c’est la personne qui est responsable de le maintenir (suite à une mobilité par exemple).</p></li>
<li><p><strong><code>"aut"</code></strong> signifie auteur : il s’agit des personnes qui ont eu une contribution importante dans le code source du <em>package</em>.</p></li>
<li><p><strong><code>"ctb"</code></strong> signifie contributeur : il s’agit des personnes qui ont eu une contribution, même minime, dans le code source du <em>package</em> (ou sa documentation).</p></li>
<li><p><strong><code>"cph"</code></strong> signifie <em>copyright holder</em> soit détenteur des droits de propriété intellectuelle. En tant qu’agent de l’Insee, le travail que vous produisez ne vous appartient pas : il appartient à l’Insee.</p></li>
</ul>
<p>L’ensemble de ces informations permet de préciser le rôle de chacun et d’apporter la reconnaissance nécessaire à toutes les personnes qui ont été associées au travail.</p>
<p>Dans le cas où vous travaillez seul, le champ <code>Authors@R</code> ressemblera plutôt à cela :</p>
<pre><code>Authors@R: c(
  person(&quot;Mon prénom&quot;, 
         &quot;Mon nom&quot;, 
         role = c(&quot;aut&quot;, &quot;cre&quot;), 
         email = &quot;monprenom.monnom@insee.fr&quot;),
  person(family = &quot;Institut national de la statistique et des études économiques&quot;, 
         role = &quot;cph&quot;)
  )</code></pre>
<p><strong>Remplissez le champ <code>Authors@R</code></strong> : si vous travaillez en groupe, prenez bien soin de renseigner l’ensemble des noms et de préciser qui sera en charge de la maintenance de votre <em>package</em>.</p>
<p>Vous pouvez modifier directement le fichier <code>DESCRIPTION</code> à la main ou bien vous aider du <em>package</em> <strong>desc</strong> comme suit :</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="package.html#cb49-1" aria-hidden="true" tabindex="-1"></a>desc<span class="sc">::</span><span class="fu">desc_set_authors</span>(<span class="fu">c</span>(</span>
<span id="cb49-2"><a href="package.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">person</span>(</span>
<span id="cb49-3"><a href="package.html#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Mon prénom&quot;</span>, </span>
<span id="cb49-4"><a href="package.html#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Mon nom&quot;</span>, </span>
<span id="cb49-5"><a href="package.html#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">role =</span> <span class="fu">c</span>(<span class="st">&quot;aut&quot;</span>, <span class="st">&quot;cre&quot;</span>), </span>
<span id="cb49-6"><a href="package.html#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">email =</span> <span class="st">&quot;monprenom.monnom@insee.fr&quot;</span></span>
<span id="cb49-7"><a href="package.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb49-8"><a href="package.html#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">person</span>(</span>
<span id="cb49-9"><a href="package.html#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;Institut national de la statistique et des études économiques&quot;</span>, </span>
<span id="cb49-10"><a href="package.html#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">role =</span> <span class="st">&quot;cph&quot;</span></span>
<span id="cb49-11"><a href="package.html#cb49-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-12"><a href="package.html#cb49-12" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div>
</div>
<div id="champ-description" class="section level4 unnumbered hasAnchor">
<h4>Champ <code>Description</code><a href="package.html#champ-description" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Vous devez modifier ce champ</strong>. Il s’agit d’une description résumée de ce que fait le <em>package</em> (un seul paragraphe, plusieurs phrases autorisées).<br />
Si vous modifiez le fichier <code>DESCRIPTION</code> à la main, prenez bien soin d’indenter chaque ligne avec 2 espaces au minimum. Sinon, vous pouvez vous aider du <em>package</em> <strong>desc</strong> comme suit :</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="package.html#cb50-1" aria-hidden="true" tabindex="-1"></a>desc<span class="sc">::</span><span class="fu">desc_set</span>(</span>
<span id="cb50-2"><a href="package.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="st">&quot;J&#39;ai créé ce package pour apprendre. </span></span>
<span id="cb50-3"><a href="package.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="st">  Ne l&#39;installez pas il ne fait rien d&#39;intéressant pour l&#39;instant.&quot;</span></span>
<span id="cb50-4"><a href="package.html#cb50-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div id="champ-license" class="section level3 unnumbered hasAnchor">
<h3>Champ <code>License</code><a href="package.html#champ-license" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Vous devez choisir une licence</strong>.</p>
<p>Pour cela vous devez vous appuyer sur le cadre défini au sein de l’Insee <a href="https://open-source-modif.dev.innovation.insee.eu/politique/" class="uri">https://open-source-modif.dev.innovation.insee.eu/politique/</a>.<br />
<span class="red">TODO: demander l’url stable à la DIIT</span></p>
<p>Il est possible dans l’administration d’utiliser la licence dite MIT. C’est ce que nous allons faire dans ce support :</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="package.html#cb51-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_mit_license</span>(</span>
<span id="cb51-2"><a href="package.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;Institut national de la statistique et des études économiques (Insee)&quot;</span></span>
<span id="cb51-3"><a href="package.html#cb51-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Pour utiliser une licence avec <em>copyleft</em> (c’est-à-dire sans droit de réutilisation commerciale de votre travail), vous pouvez choisir la licence GPL-3 :</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="package.html#cb52-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_gpl3_license</span>(</span>
<span id="cb52-2"><a href="package.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;Institut national de la statistique et des études économiques (Insee)&quot;</span></span>
<span id="cb52-3"><a href="package.html#cb52-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="pour-aller-plus-loin-1" class="section level4 unnumbered hasAnchor">
<h4>Pour aller plus loin<a href="package.html#pour-aller-plus-loin-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>R reconnaît un certain nombre de licences. Voici une fonction pour récupérer la liste exhaustive des licences reconnues par <code>R</code> dans un <code>tibble</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="package.html#cb53-1" aria-hidden="true" tabindex="-1"></a>get_licenses <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb53-2"><a href="package.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  share_dir <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">&#39;R_SHARE_DIR&#39;</span>)</span>
<span id="cb53-3"><a href="package.html#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">nzchar</span>(share_dir)) {</span>
<span id="cb53-4"><a href="package.html#cb53-4" aria-hidden="true" tabindex="-1"></a>    share_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">Sys.getenv</span>(<span class="st">&#39;R_HOME&#39;</span>), <span class="st">&#39;share&#39;</span>)</span>
<span id="cb53-5"><a href="package.html#cb53-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-6"><a href="package.html#cb53-6" aria-hidden="true" tabindex="-1"></a>  licenses_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(share_dir, <span class="st">&#39;licenses&#39;</span>, <span class="st">&#39;license.db&#39;</span>)</span>
<span id="cb53-7"><a href="package.html#cb53-7" aria-hidden="true" tabindex="-1"></a>  licenses <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(</span>
<span id="cb53-8"><a href="package.html#cb53-8" aria-hidden="true" tabindex="-1"></a>    licenses_file, </span>
<span id="cb53-9"><a href="package.html#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>, </span>
<span id="cb53-10"><a href="package.html#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> <span class="st">&#39;data&#39;</span>,</span>
<span id="cb53-11"><a href="package.html#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">data =</span> readr<span class="sc">::</span><span class="fu">col_character</span>())</span>
<span id="cb53-12"><a href="package.html#cb53-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-13"><a href="package.html#cb53-13" aria-hidden="true" tabindex="-1"></a>  licenses <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">separate</span>(licenses, data, <span class="fu">c</span>(<span class="st">&#39;key&#39;</span>, <span class="st">&#39;value&#39;</span>), <span class="st">&#39;:</span><span class="sc">\\</span><span class="st">s&#39;</span>, <span class="at">extra =</span> <span class="st">&#39;merge&#39;</span>)</span>
<span id="cb53-14"><a href="package.html#cb53-14" aria-hidden="true" tabindex="-1"></a>  licenses <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(licenses, <span class="at">id =</span> <span class="fu">cumsum</span>(key <span class="sc">==</span> <span class="st">&#39;Name&#39;</span>))</span>
<span id="cb53-15"><a href="package.html#cb53-15" aria-hidden="true" tabindex="-1"></a>  licenses <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">spread</span>(licenses, <span class="st">&#39;key&#39;</span>, <span class="st">&#39;value&#39;</span>)</span>
<span id="cb53-16"><a href="package.html#cb53-16" aria-hidden="true" tabindex="-1"></a>  licenses <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(licenses, <span class="at">File =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(File), <span class="cn">NA</span>, <span class="fu">file.path</span>(<span class="fu">dirname</span>(share_dir), File)))</span>
<span id="cb53-17"><a href="package.html#cb53-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(licenses, Name, Abbrev, Version, SSS, dplyr<span class="sc">::</span><span class="fu">everything</span>(), <span class="sc">-</span>id)</span>
<span id="cb53-18"><a href="package.html#cb53-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-19"><a href="package.html#cb53-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-20"><a href="package.html#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="fu">get_licenses</span>()</span></code></pre></div>
</div>
<div id="champ-encoding" class="section level4 unnumbered hasAnchor">
<h4>Champ <code>Encoding</code><a href="package.html#champ-encoding" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>N’y touchez pas</strong>. <code>UTF-8</code> signifie que dans le fichier <code>DESCRIPTION</code>, vous pouvez utiliser des caractères accentués (attention, cette précision n’est valable que pour le fichier <code>DESCRIPTION</code>).</p>
</div>
<div id="champ-lazydata" class="section level4 unnumbered hasAnchor">
<h4>Champ <code>LazyData</code><a href="package.html#champ-lazydata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>N’y touchez pas</strong>, cela rend plus facile l’accès aux données du <em>package</em> (si vous incluez des données).</p>
</div>
<div id="les-autres-champs-que-vous-pouvez-ajouter" class="section level4 unnumbered hasAnchor">
<h4>Les autres champs que vous pouvez ajouter<a href="package.html#les-autres-champs-que-vous-pouvez-ajouter" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>De nombreux autres champs optionnels peuvent être ajoutés (<a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#The-DESCRIPTION-file">voir le manuel officiel</a> de <code>R</code>). Nous ne mentionnerons ici que ceux qui peuvent être utiles.</p>
<div id="champ-language" class="section level5 unnumbered hasAnchor">
<h5>Champ <code>Language</code><a href="package.html#champ-language" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Si la documentation de votre <em>package</em> est en français, vous devez le préciser en rajoutant dans le ficher <code>DESCRIPTION</code> :</p>
<pre><code>Language: fr</code></pre>
<p>Si la documentation est en français et en anglais, le champ <code>Language</code> sera :</p>
<pre><code>Language: en, fr</code></pre>
<p>Vous pouvez rajouter ce champ en vous aidant du <em>package</em> <strong>desc</strong> :</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="package.html#cb56-1" aria-hidden="true" tabindex="-1"></a>desc<span class="sc">::</span><span class="fu">desc_set</span>(<span class="at">Language =</span> <span class="st">&quot;fr&quot;</span>)</span></code></pre></div>
</div>
<div id="champ-url" class="section level5 unnumbered hasAnchor">
<h5>Champ <code>URL</code><a href="package.html#champ-url" class="anchor-section" aria-label="Anchor link to header"></a></h5>
</div>
<div id="champ-bugreports" class="section level5 unnumbered hasAnchor">
<h5>Champ <code>BugReports</code><a href="package.html#champ-bugreports" class="anchor-section" aria-label="Anchor link to header"></a></h5>
</div>
</div>
<div id="contrôle-de-conformité-1" class="section level4 unnumbered hasAnchor">
<h4>Contrôle de conformité<a href="package.html#contrôle-de-conformité-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Une fois que les méta-données sont à jour</strong>, effectuez un contrôle de conformité.</p>
<p>Vous devez obtenir :</p>
<pre><code>0 errors | 0 warnings  | 0 notes</code></pre>
<p>Sinon, vous devez corriger les problèmes.</p>
<div id="note-pour-les-formateurs" class="section level5 unnumbered hasAnchor">
<h5>Note pour les formateurs<a href="package.html#note-pour-les-formateurs" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Si vous souhaitez faire faire un petit exercice ou une démonstration, voici quelques idées pour générer des notes ou erreurs.</p>
<p>Vous pouvez “oublier” de mettre un point à la dernière phrase du champ <code>Description</code>. Ainsi, le check renverra :</p>
<pre><code>&gt; checking DESCRIPTION meta-information ... NOTE
  Malformed Description field: should contain one or more complete sentences.</code></pre>
<p>À l’inverse, vous pouvez mettre un point final au champ <code>Title</code> et vous obtiendrez :</p>
<pre><code>&gt; checking DESCRIPTION meta-information ... NOTE
  Malformed Title field: should not end in a period.</code></pre>
<p>Retirez le champ <code>Authors@R</code> et vous obtiendrez l’erreur suivante :</p>
<pre><code>Champs requis mais manquants ou vides :
  &#39;Author&#39; &#39;Maintainer&#39;</code></pre>
</div>
</div>
</div>
</div>
<div id="configurer-les-outils-de-développement" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Configurer les outils de développement<a href="package.html#configurer-les-outils-de-développement" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="créer-un-dépôt-vide-dans-gitlab" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Créer un dépôt vide dans GitLab<a href="package.html#créer-un-dépôt-vide-dans-gitlab" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Le <em>package</em> que nous allons créer s’appelle <code>monpetitpaquet</code>. Sous GitLab, créez un nouveau projet public s’appelant <code>monpetitpaquet</code>.</p>
<p><strong>N’incluez aucun fichier par défaut (<code>README</code>, …).</strong></p>
<div id="pour-aller-beaucoup-plus-loin" class="section level4 unnumbered hasAnchor">
<h4>Pour aller (beaucoup) plus loin<a href="package.html#pour-aller-beaucoup-plus-loin" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Il est possible de créer un nouveau dépôt GitLab directement depuis <code>R</code>. En effet, GitLab propose une API REST : cela permet d’exécuter des tâches grâce à l’envoi de requêtes de type web.</p>
<p>Bien évidemment, il faut posséder l’équivalent du couple identifiant/mot de passe pour pouvoir effectuer une telle modification sur votre profil. Cet équivalent s’appelle un jeton d’accès privé (<em>private access token</em>). Pour générer un jeton d’accès privé, dans l’interface de GitLab, vous devez aller dans la rubrique <em>Settings</em>, puis le menu <em>Access Tokens</em>.</p>
<p><img src="pics/07_packages/gitlab_pat.png" /></p>
<p>Cochez la case API et donner un nom à ce token. Ensuite, cliquer sur le bouton <em>Create personal access token</em>.</p>
<p>Sur la page suivante, copiez le jeton d’accès privé. Attention, ce jeton d’accès est privé : vous ne devez jamais le mettre dans un programme. Il doit rester connu de vous seul(e) car c’est l’équivalent de votre couple identifiant/mot de passe. Vous allez donc le stocker localement dans votre profil personnel sous la forme d’une variable d’environnement. Pour cela, vous allez modifier votre fichier <code>.Renviron</code> personnel. Pour ouvrir ce fichier, utiliser la commande :</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="package.html#cb61-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">edit_r_environ</span>(<span class="st">&quot;user&quot;</span>)</span></code></pre></div>
<p>Dans le fichier <code>.Renviron</code>, ajouter la ligne suivante :</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb62-1"><a href="package.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="va">GITLAB_PAT</span><span class="op">=</span>tdsqf4fhEfE12fUF7F5Z <span class="co"># copiez votre token privé ici</span></span></code></pre></div>
<p>Vous devez ensuite redémarrer votre session R.</p>
<p>Une fois ce paramétrage effectué, vous pouvez créer depuis <code>R</code> un nouveau dépôt GitLab comme suit (voir <a href="https://docs.gitlab.com/ee/api/projects.html#create-project">la documentation de l’API de GitLab</a>) :</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="package.html#cb63-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">POST</span>(</span>
<span id="cb63-2"><a href="package.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">&quot;https://gitlab.com/api/v4/projects&quot;</span>, <span class="co"># remplacer par l&#39;adresse du GitLab Insee</span></span>
<span id="cb63-3"><a href="package.html#cb63-3" aria-hidden="true" tabindex="-1"></a>  httr<span class="sc">::</span><span class="fu">add_headers</span>(<span class="st">`</span><span class="at">Private-Token</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;GITLAB_PAT&quot;</span>)),</span>
<span id="cb63-4"><a href="package.html#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">body =</span> <span class="fu">list</span>(</span>
<span id="cb63-5"><a href="package.html#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="st">&quot;monpetitpaquet&quot;</span>, <span class="co"># le nom de votre nouveau dépôt</span></span>
<span id="cb63-6"><a href="package.html#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">visibility =</span> <span class="st">&quot;public&quot;</span></span>
<span id="cb63-7"><a href="package.html#cb63-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-8"><a href="package.html#cb63-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-9"><a href="package.html#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="package.html#cb63-10" aria-hidden="true" tabindex="-1"></a>httr<span class="sc">::</span><span class="fu">stop_for_status</span>(res)</span>
<span id="cb63-11"><a href="package.html#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="package.html#cb63-12" aria-hidden="true" tabindex="-1"></a>httr<span class="sc">::</span><span class="fu">content</span>(res)</span></code></pre></div>
<p>De façon équivalente, vous pouvez tester le <em>package</em> <strong>gitlabr</strong> (attention, il n’est plus activement maintenu):</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="package.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gitlabr)</span>
<span id="cb64-2"><a href="package.html#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="package.html#cb64-3" aria-hidden="true" tabindex="-1"></a>my_gitlab <span class="ot">&lt;-</span> <span class="fu">gl_connection</span>(</span>
<span id="cb64-4"><a href="package.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://gitlab.com&quot;</span>, <span class="co"># remplacer par l&#39;adresse du GitLab Insee</span></span>
<span id="cb64-5"><a href="package.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.getenv</span>(<span class="st">&quot;GITLAB_PAT&quot;</span>)</span>
<span id="cb64-6"><a href="package.html#cb64-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-7"><a href="package.html#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="package.html#cb64-8" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">my_gitlab</span>(</span>
<span id="cb64-9"><a href="package.html#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">req =</span> <span class="st">&quot;projects&quot;</span>, </span>
<span id="cb64-10"><a href="package.html#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">verb =</span> httr<span class="sc">::</span>POST, </span>
<span id="cb64-11"><a href="package.html#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">&quot;monpetitpaquet&quot;</span>, <span class="co"># le nom de votre nouveau dépôt</span></span>
<span id="cb64-12"><a href="package.html#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">visibility =</span> <span class="st">&quot;public&quot;</span></span>
<span id="cb64-13"><a href="package.html#cb64-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div id="utiliser-git-dans-le-projet-rstudio" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Utiliser git dans le projet RStudio<a href="package.html#utiliser-git-dans-le-projet-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="package.html#cb65-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_git</span>()</span></code></pre></div>
<p>Vous devriez obtenir un message vous proposant de réaliser un premier commit :</p>
<pre><code>✔ Initialising Git repo
✔ Adding &#39;.Rhistory&#39;, &#39;.RData&#39; to &#39;.gitignore&#39;
There are 7 uncommitted files:
* &#39;.gitignore&#39;
* &#39;.Rbuildignore&#39;
* &#39;DESCRIPTION&#39;
* &#39;LICENSE&#39;
* &#39;LICENSE.md&#39;
* &#39;monpetitpaquet.Rproj&#39;
* &#39;NAMESPACE&#39;
Is it ok to commit them?

1: Negative
2: Yup
3: Not now

Selection: </code></pre>
<p>Répondez par l’affirmative ou bien réalisez ce premier commit par vous-même.</p>
<p>Vous allez ensuite obtenir un second message qui vous propose de redémarrer RStudio pour faire apparaître le panneau <code>Git</code> :</p>
<pre><code>✔ Adding files
✔ Commit with message &#39;Initial commit&#39;
● A restart of RStudio is required to activate the Git pane
Restart now?

1: I agree
2: Absolutely not
3: Negative

Selection: </code></pre>
<p>Là encore, vous avez besoin de répondre par l’affirmative ou bien redémarrez RStudio vous-même.</p>
</div>
<div id="créer-le-lien-entre-le-dépôt-gitlab-et-le-projet-rstudio" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Créer le lien entre le dépôt GitLab et le projet RStudio<a href="package.html#créer-le-lien-entre-le-dépôt-gitlab-et-le-projet-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="package.html#cb68-1" aria-hidden="true" tabindex="-1"></a>repo_url <span class="ot">&lt;-</span> <span class="st">&quot;git@gitlab.com:RLesur/monpetitpaquet.git&quot;</span></span>
<span id="cb68-2"><a href="package.html#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="package.html#cb68-3" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_git_remote</span>(<span class="at">url =</span> repo_url)</span>
<span id="cb68-4"><a href="package.html#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="package.html#cb68-5" aria-hidden="true" tabindex="-1"></a>git2r<span class="sc">::</span><span class="fu">push</span>(<span class="at">name =</span> <span class="st">&quot;origin&quot;</span>, </span>
<span id="cb68-6"><a href="package.html#cb68-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">refspec =</span> <span class="st">&quot;refs/heads/master&quot;</span>, </span>
<span id="cb68-7"><a href="package.html#cb68-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">set_upstream =</span> <span class="cn">TRUE</span></span>
<span id="cb68-8"><a href="package.html#cb68-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>ou bien dans le terminal (bash) :</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb69-1"><a href="package.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> remote add origin git@gitlab.com:RLesur/monpetitpaquet.git</span>
<span id="cb69-2"><a href="package.html#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="package.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin master</span></code></pre></div>
</div>
<div id="utiliser-testthat-pour-les-tests" class="section level3 hasAnchor" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Utiliser <code>testthat</code> pour les tests<a href="package.html#utiliser-testthat-pour-les-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Nous allons maintenant créer les dossiers et fichiers nécessaires pour tester notre code. Nous allons utiliser le <em>package</em> <strong>testthat</strong> pour nous aider à écrire des tests.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="package.html#cb70-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_testthat</span>()</span></code></pre></div>
<p>Vous pouvez constater qu’un répertoire <code>tests</code> a été créé avec à l’intérieur un répertoire <code>testthat</code> qui pour l’instant est vide et un fichier <code>testthat.R</code> déjà rempli dont voici le contenu (<strong>ne le modifiez pas</strong>) :</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="package.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb71-2"><a href="package.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(monpetitpaquet)</span>
<span id="cb71-3"><a href="package.html#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="package.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">test_check</span>(<span class="st">&quot;monpetitpaquet&quot;</span>)</span></code></pre></div>
<div id="pour-aller-plus-loin-2" class="section level4 unnumbered hasAnchor">
<h4>Pour aller plus loin<a href="package.html#pour-aller-plus-loin-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Vous pouvez utiliser d’autres <em>packages</em> pour écrire et gérer vos tests tels que <strong>tinytest</strong> ou <strong>testit</strong>. Le choix du <em>package</em> de gestion de test n’est pas important, l’essentiel étant que votre <em>package</em> comprenne des tests.</p>
</div>
</div>
<div id="utiliser-lintégration-continue-de-gitlab" class="section level3 hasAnchor" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Utiliser l’intégration continue de GitLab<a href="package.html#utiliser-lintégration-continue-de-gitlab" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Afin de sécuriser notre travail, nous allons utiliser le service d’intégration continue de GitLab. L’idée est la suivante : ce sera un filet de sécurité au cas où on oublierait de réaliser un contrôle de conformité avant de pousser notre travail.</p>
<p>L’intégration continue fonctionne de la façon suivante : à chaque <em>push</em>, un serveur va automatiquement exécuter <code>devtools::check()</code>. Si le résultat est OK, une coche verte apparaîtra dans le projet GitLab. Si le <em>package</em> n’est pas conforme, ce sera une croix rouge (vous recevrez également un mail vous avertissant qu’il y a un problème).</p>
<p>Le rapport du contrôle de conformité sera bien évidemment disponible afin que vous puissiez comprendre quel est le problème.</p>
<p>Pour utiliser l’intégration continue de GitLab, exécutez :</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="package.html#cb72-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_gitlab_ci</span>()</span></code></pre></div>
<p>Attention, vérifiez bien que le <em>package</em> <strong>usethis</strong> a une version supérieure ou égale à <code>1.5.1</code>. Cette commande a normalement créé un fichier nommé <code>.gitlab-ci.yml</code> à la racine de votre projet.</p>
<p>Nous allons l’ouvrir pour vérifier son contenu. Si votre version de RStudio est trop ancienne, vous ne le verrez pas dans l’explorateur de fichier de RStudio (ce qui n’est vraiment pas pratique pour l’ouvrir). Dans ce cas, ouvrez-le en exécutant <code>rstudioapi::navigateToFile(".gitlab-ci.yml")</code>.</p>
<p>Si <strong>usethis</strong> est bien supérieur à la version <code>1.5.1</code>, le contenu du fichier <code>.gitlab-ci.yml</code> devrait être le suivant :</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb73-1"><a href="package.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span><span class="kw">:</span><span class="at"> rocker/tidyverse</span></span>
<span id="cb73-2"><a href="package.html#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="package.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stages</span><span class="kw">:</span></span>
<span id="cb73-4"><a href="package.html#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> build</span></span>
<span id="cb73-5"><a href="package.html#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> test</span></span>
<span id="cb73-6"><a href="package.html#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> deploy</span></span>
<span id="cb73-7"><a href="package.html#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="package.html#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="fu">building</span><span class="kw">:</span></span>
<span id="cb73-9"><a href="package.html#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> build</span></span>
<span id="cb73-10"><a href="package.html#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb73-11"><a href="package.html#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> R -e &quot;remotes::install_deps(dependencies = TRUE)&quot;</span></span>
<span id="cb73-12"><a href="package.html#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> R -e &#39;devtools::check()&#39;</span></span>
<span id="cb73-13"><a href="package.html#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="package.html#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co"># To have the coverage percentage appear as a gitlab badge follow these</span></span>
<span id="cb73-15"><a href="package.html#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="co"># instructions:</span></span>
<span id="cb73-16"><a href="package.html#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="co"># https://docs.gitlab.com/ee/user/project/pipelines/settings.html#test-coverage-parsing</span></span>
<span id="cb73-17"><a href="package.html#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="co"># The coverage parsing string is</span></span>
<span id="cb73-18"><a href="package.html#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Coverage: \d+\.\d+</span></span>
<span id="cb73-19"><a href="package.html#cb73-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-20"><a href="package.html#cb73-20" aria-hidden="true" tabindex="-1"></a><span class="fu">testing</span><span class="kw">:</span></span>
<span id="cb73-21"><a href="package.html#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> test</span></span>
<span id="cb73-22"><a href="package.html#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">allow_failure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb73-23"><a href="package.html#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">when</span><span class="kw">:</span><span class="at"> on_success</span></span>
<span id="cb73-24"><a href="package.html#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">only</span><span class="kw">:</span></span>
<span id="cb73-25"><a href="package.html#cb73-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> master</span></span>
<span id="cb73-26"><a href="package.html#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb73-27"><a href="package.html#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> Rscript -e &#39;install.packages(&quot;DT&quot;)&#39;</span></span>
<span id="cb73-28"><a href="package.html#cb73-28" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> Rscript -e &#39;covr::gitlab(quiet = FALSE)&#39;</span></span>
<span id="cb73-29"><a href="package.html#cb73-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">artifacts</span><span class="kw">:</span></span>
<span id="cb73-30"><a href="package.html#cb73-30" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb73-31"><a href="package.html#cb73-31" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> public</span></span>
<span id="cb73-32"><a href="package.html#cb73-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-33"><a href="package.html#cb73-33" aria-hidden="true" tabindex="-1"></a><span class="co"># To produce a code coverage report as a GitLab page see</span></span>
<span id="cb73-34"><a href="package.html#cb73-34" aria-hidden="true" tabindex="-1"></a><span class="co"># https://about.gitlab.com/2016/11/03/publish-code-coverage-report-with-gitlab-pages/</span></span>
<span id="cb73-35"><a href="package.html#cb73-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-36"><a href="package.html#cb73-36" aria-hidden="true" tabindex="-1"></a><span class="fu">pages</span><span class="kw">:</span></span>
<span id="cb73-37"><a href="package.html#cb73-37" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> deploy</span></span>
<span id="cb73-38"><a href="package.html#cb73-38" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb73-39"><a href="package.html#cb73-39" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> testing</span></span>
<span id="cb73-40"><a href="package.html#cb73-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb73-41"><a href="package.html#cb73-41" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> ls</span></span>
<span id="cb73-42"><a href="package.html#cb73-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">artifacts</span><span class="kw">:</span></span>
<span id="cb73-43"><a href="package.html#cb73-43" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb73-44"><a href="package.html#cb73-44" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> public</span></span>
<span id="cb73-45"><a href="package.html#cb73-45" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">expire_in</span><span class="kw">:</span><span class="at"> 30 days</span></span>
<span id="cb73-46"><a href="package.html#cb73-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">only</span><span class="kw">:</span></span>
<span id="cb73-47"><a href="package.html#cb73-47" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> master</span></span></code></pre></div>
<div id="pour-aller-plus-loin-3" class="section level4 hasAnchor" number="5.2.5.1">
<h4><span class="header-section-number">5.2.5.1</span> Pour aller plus loin<a href="package.html#pour-aller-plus-loin-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TODO : expliquer le fonctionnement de GitLab CI, ce qu’est une image docker, les particularités des images rocker qui utilisent les snapshots MRAN, les tags (car le seul problème de ce fichier c’est qu’il utilise <code>latest</code> implicitement, ce qu’il faut éviter avec les images docker)… ça pourrait être une formation en soi mais il y a sans doute un minimum à expliquer dans ce support aux curieuses et curieux qui aiment comprendre. Parce que l’intégration continue, c’est quand même génial !</p>
</div>
</div>
</div>
<div id="développer-un-package" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Développer un <em>package</em><a href="package.html#développer-un-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="inclure-du-code-le-documenter-et-le-tester" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Inclure du code, le documenter et le tester<a href="package.html#inclure-du-code-le-documenter-et-le-tester" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>On a effectué plusieurs tâches jusqu’ici (création du <em>package</em>, de ses méta-données et mise en place des outils de développement) mais on n’a toujours pas mis de code <code>R</code> dans notre <em>package</em>. Une bonne habitude à prendre est d’écrire en même temps le code source de la fonction, sa documentation et les tests. Allons-y.</p>
<div id="inclure-du-code" class="section level4 unnumbered hasAnchor">
<h4>Inclure du code<a href="package.html#inclure-du-code" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Le code source de votre <em>package</em> va se trouver dans le répertoire <code>R</code> du projet. Ce répertoire comprendra des fichiers source avec l’extension <code>.R</code>. Il est interdit de créer des sous-répertoires à ce dossier (si vous le faîtes, le contrôle de conformité sera en erreur).</p>
<p>L’exercice que nous vous proposons est d’inclure dans notre <em>package</em> une fonction vue précédemment pour recoder une valeur d’un vecteur :</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="package.html#cb74-1" aria-hidden="true" tabindex="-1"></a>fix_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(x, na.value) {</span>
<span id="cb74-2"><a href="package.html#cb74-2" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">==</span> na.value] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb74-3"><a href="package.html#cb74-3" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb74-4"><a href="package.html#cb74-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Comment nommer le fichier qui comprendra le code de la fonction <code>fix_missing()</code> ? L’usage est de donner le même nom que la fonction. Autrement dit le code source de la fonction <code>fix_missing()</code> se trouvera dans le fichier <code>R/fix_missing.R</code>.</p>
<p>Pour créer ce fichier, nous pouvons exécuter la commande suivante :</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="package.html#cb75-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">&quot;fix_missing&quot;</span>)</span></code></pre></div>
<p>Cette commande crée le fichier <code>R/fix_missing.R</code> et l’ouvre. Il ne vous reste plus qu’à inclure le code source de cette fonction.</p>
<p>Comme nous l’avons vu précédemment, nous devons documenter cette fonction. Pour cela, nous pouvons inclure un squelette de documentation grâce à la commande RStudio <em>Code &gt; Insert Roxygen Skeleton</em>. Vous devriez obtenir ceci :</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="package.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Title</span></span>
<span id="cb76-2"><a href="package.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb76-3"><a href="package.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x </span></span>
<span id="cb76-4"><a href="package.html#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param na.value </span></span>
<span id="cb76-5"><a href="package.html#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb76-6"><a href="package.html#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return</span></span>
<span id="cb76-7"><a href="package.html#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb76-8"><a href="package.html#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb76-9"><a href="package.html#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb76-10"><a href="package.html#cb76-10" aria-hidden="true" tabindex="-1"></a>fix_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(x, na.value) {</span>
<span id="cb76-11"><a href="package.html#cb76-11" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">==</span> na.value] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb76-12"><a href="package.html#cb76-12" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb76-13"><a href="package.html#cb76-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Vous devez remplir les différents champs. Pour vous aider à formater la documentation, il est possible d’utiliser markdown<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. Pour cela, vous devez exécuter :</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="package.html#cb77-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_roxygen_md</span>()</span></code></pre></div>
<pre><code>✔ Setting active project to &#39;C:/Users/romain.lesur/monpetitpaquet&#39;
● Refer to `roxygen2md::roxygen2md()` to use markdown markup with roxygen2.
● Run `devtools::document()` when you&#39;re done.</code></pre>
<p>Comme indiqué, exécutez :</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="package.html#cb79-1" aria-hidden="true" tabindex="-1"></a>roxygen2md<span class="sc">::</span><span class="fu">roxygen2md</span>()</span></code></pre></div>
<p>Devons-nous écrire la documentation en anglais ou bien est-il possible de l’écrire en français ? Quid des caractères accentués ?<br />
Il est tout à fait possible d’utiliser des caractères accentués dans la documentation. Pour cela, vous devez inclure la ligne suivante dans chaque documentation de fonction :</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="package.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @encoding UTF-8</span></span></code></pre></div>
<p>Il est cependant préférable d’éviter de mettre des caractères accentués dans le titre des pages d’aide (car il ne s’affichent pas bien sous Windows).</p>
<p>Exemple corrigé :</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="package.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Recode une valeur en valeur manquante</span></span>
<span id="cb81-2"><a href="package.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb81-3"><a href="package.html#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Cette fonction permet de recoder une valeur déclarée par l&#39;utilisateur en</span></span>
<span id="cb81-4"><a href="package.html#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; valeur manquante (`NA`).</span></span>
<span id="cb81-5"><a href="package.html#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb81-6"><a href="package.html#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x Un vecteur ou une liste. </span></span>
<span id="cb81-7"><a href="package.html#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param na.value La valeur que l&#39;on souhaite recoder en valeur manquante (`NA`).</span></span>
<span id="cb81-8"><a href="package.html#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb81-9"><a href="package.html#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Un vecteur si `x` est un vecteur, une liste si `x` est une liste. La</span></span>
<span id="cb81-10"><a href="package.html#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;     longueur de l&#39;objet renvoyé est identique à la longueur de `x`.  </span></span>
<span id="cb81-11"><a href="package.html#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @encoding UTF-8</span></span>
<span id="cb81-12"><a href="package.html#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb81-13"><a href="package.html#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb81-14"><a href="package.html#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb81-15"><a href="package.html#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; data &lt;- c(10, 20, -99)</span></span>
<span id="cb81-16"><a href="package.html#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fix_missing(data, -99)</span></span>
<span id="cb81-17"><a href="package.html#cb81-17" aria-hidden="true" tabindex="-1"></a>fix_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(x, na.value) {</span>
<span id="cb81-18"><a href="package.html#cb81-18" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">==</span> na.value] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb81-19"><a href="package.html#cb81-19" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb81-20"><a href="package.html#cb81-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Maintenant que nous avons réalisé la documentation <code>roxygen</code> de la fonction, nous devons générer les fichiers de documentation attendus par <code>R</code> (ce sont des fichiers <code>Rd</code> situés dans le répertoire <code>man</code>.)</p>
<p>Nous allons exécuter la commande suivante (nous exécuterons très souvent cette commande):</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="package.html#cb82-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span></code></pre></div>
<p>Cette commande va avoir deux effets principaux :</p>
<ul>
<li>constuire les fichiers de documentation au format attendu par <code>R</code> (les fichiers <code>Rd</code> qui se trouve dans le répertoire <code>man</code> du projet);</li>
<li>mettre à jour le fichier <code>NAMESPACE</code>.</li>
</ul>
<p>Qu’est ce que le fichier <code>NAMESPACE</code>? Voici le fichier <code>NAMESPACE</code>que nous avons à ce stade :</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="package.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generated by roxygen2: do not edit by hand</span></span>
<span id="cb83-2"><a href="package.html#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="package.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(fix_missing)</span></code></pre></div>
<p>Le fichier <code>NAMESPACE</code> comprend l’ensemble des fonctions exportées par votre <em>package</em> ainsi que les fonctions importées d’autres <em>packages</em>.<br />
Notez bien le mot clé <code>@export</code> dans l’exemple précédent : cela signifie que vous souhaitez que la fonction <code>fix_missing()</code> soit mise à disposition des utilisateurs de <strong>monpetitpaquet</strong>, autrement dit elle est exportée. Lorsque nous avons exécuté <code>devtools::document()</code>, le fichier <code>NAMESPACE</code> a été actualisé en conséquence.</p>
<p><strong>Attention aux noms des fonctions exportées par votre <em>package</em> !</strong> Vous devez évitez d’utiliser les mêmes noms que d’autres <em>packages</em>. Par exemple, ce serait une très mauvaise idée d’exporter des fonctions s’appelant <code>select()</code>, <code>mutate()</code> ou <code>filter()</code> car ce sont des noms déjà mis à disposition par le <em>package</em> <strong>dplyr</strong>. Si vous faites cela, vous risquez de provoquer le mécontentement de vos utilisateurs. Une pratique répandue est de préfixer les noms de fonctions : regardez par exemple les noms des fonctions des <em>packages</em> <strong>stringr</strong> (<code>str_*</code>) et <strong>stringi</strong> (<code>stri_*</code>).</p>
<p>Pour mieux organiser votre travail, vous pouvez bien évidemment créer des fonctions à seul but interne. Dans ce cas, retirez la directive <code>@export</code>. Ces fonctions pourront être utilisées seulement à l’intérieur de votre <em>package</em>.</p>
<div id="trucs-et-astuces-pour-éviter-de-sarracher-les-cheveux" class="section level5 unnumbered hasAnchor">
<h5>Trucs et astuces pour éviter de s’arracher les cheveux<a href="package.html#trucs-et-astuces-pour-éviter-de-sarracher-les-cheveux" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div id="le-fichier-namespace" class="section level6 unnumbered hasAnchor">
<h6>Le fichier <code>NAMESPACE</code><a href="package.html#le-fichier-namespace" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>Ce fichier est généré automatiquement par la commande <code>devtools::document()</code>. Vous ne devez pas le modifier. Cependant, dans certaines circonstances, vous pouvez vous retrouver coincé à cause de lui.</p>
<p>Si à un moment, vous êtes bloqués lors d’un contrôle de conformité, <strong>n’hésitez pas à supprimer le fichier <code>NAMESPACE</code> et à le regénérer grâce à la commande <code>devtools::document()</code></strong>. Cette démarche est sûre.</p>
</div>
</div>
<div id="les-exemples" class="section level5 unnumbered hasAnchor">
<h5>Les exemples<a href="package.html#les-exemples" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Il est important d’ajouter des exemples dans votre documentation pour chaque fonction. Si vous n’en mettez pas (ce qui n’est pas bien mais qu’on fait parfois), n’oubliez pas de retirer la ligne</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="package.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span></code></pre></div>
<p>Vous devez savoir que les exemples présents dans votre documentation sont tous exécutés lors du contrôle de conformité : cela représente une garantie pour vous et vos utilisateurs (il s’agit de vos premiers tests !).<br />
Cependant, il y a des situations où cela est problématique (ces exemples prennent beaucoup de temps à tourner, ils nécessitent un identifiant pour accéder à une base de données, etc.). Dans ces cas, vous pouvez signaler qu’ils ne doivent pas être contrôlés en utilisant <code>\donttest{}</code>. Voici un exemple :</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="package.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Recode une valeur en valeur manquante</span></span>
<span id="cb85-2"><a href="package.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb85-3"><a href="package.html#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Cette fonction permet de recoder une valeur déclarée par l&#39;utilisateur en</span></span>
<span id="cb85-4"><a href="package.html#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; valeur manquante (`NA`).</span></span>
<span id="cb85-5"><a href="package.html#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb85-6"><a href="package.html#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x Un vecteur ou une liste. </span></span>
<span id="cb85-7"><a href="package.html#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param na.value La valeur que l&#39;on souhaite recoder en valeur manquante (`NA`).</span></span>
<span id="cb85-8"><a href="package.html#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb85-9"><a href="package.html#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Un vecteur si `x` est un vecteur, une liste si `x` est une liste. La</span></span>
<span id="cb85-10"><a href="package.html#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;     longueur de l&#39;objet renvoyé est identique à la longueur de `x`.  </span></span>
<span id="cb85-11"><a href="package.html#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @encoding UTF-8</span></span>
<span id="cb85-12"><a href="package.html#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb85-13"><a href="package.html#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb85-14"><a href="package.html#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb85-15"><a href="package.html#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \donttest{</span></span>
<span id="cb85-16"><a href="package.html#cb85-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; data &lt;- c(10, 20, -99)</span></span>
<span id="cb85-17"><a href="package.html#cb85-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fix_missing(data, -99)</span></span>
<span id="cb85-18"><a href="package.html#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb85-19"><a href="package.html#cb85-19" aria-hidden="true" tabindex="-1"></a>fix_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(x, na.value) {</span>
<span id="cb85-20"><a href="package.html#cb85-20" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">==</span> na.value] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb85-21"><a href="package.html#cb85-21" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb85-22"><a href="package.html#cb85-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="inclure-des-tests" class="section level4 unnumbered hasAnchor">
<h4>Inclure des tests<a href="package.html#inclure-des-tests" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Cette partie est absolument fondamentale. Elle va consister à rajouter des tests à votre <em>package</em>. Ces tests seront exécutés durant le contrôle de conformité.</p>
<p>Au sujet des tests, il existe deux <strong>règles d’or</strong>:</p>
<ul>
<li>La première règle est que <strong>toute fonctionnalité non testée comprend un bug</strong>. Cette règle a beau être connue par tous, tout le monde a un biais de surconfiance qui le pousse à ne pas tout tester. Et “comme par hasard”, les programmes plantent toujours là où on n’a pas implémenté de tests. Tout le monde se fait avoir, <strong>même les développeurs les plus aguerris</strong>. Au cas où vous hésiteriez à écrire des tests, vous voilà prévenus.</li>
<li>La seconde règle d’or est : <strong>tout bug que vous avez détecté doit donner lieu à l’écriture d’un test</strong>. Cela évite de se faire prendre plusieurs fois au même endroit.</li>
</ul>
<p>Enfin, le dernier intérêt des tests est d’éviter que votre <em>package</em> se brise si vous faites des petites modifications ultérieurement (si, si, ça arrive…).</p>
<p>Mais vous allez voir, écrire des tests est quelque chose de simple et amusant. Nous allons utiliser le <em>package</em> <strong>testthat</strong> pour nous aider à les écrire et générer de beaux rapports. Nous allons écrire des tests pour la fonction <code>fix_missing()</code> de notre <em>package</em>. Pour créer un nouveau fichier qui comprendra nos tests, nous allons utiliser la fonction <code>usethis::use_test()</code>. Exécutez la commande :</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="package.html#cb86-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">&quot;fix_missing&quot;</span>)</span></code></pre></div>
<p>Cette fonction a créé le fichier <code>tests/test-fix_missing.R</code>. Ouvrez ce fichier. Voici son contenu (nous allons bien évidemment le remplacer) :</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="package.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;multiplication works&quot;</span>, {</span>
<span id="cb87-2"><a href="package.html#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb87-3"><a href="package.html#cb87-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>L’ensemble des fonctions (<code>test_that()</code>, <code>expect_*()</code>…) sont issues du <em>package</em> <strong>testthat</strong>.</p>
<p>Ecrivons un premier test. Il s’agit d’un bon exercice. Vous pouvez lire en parallèle la documentation que nous avons écrite pour la fonction <code>fix_missing()</code> et les tests ci-dessous.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="package.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;fix_missing fonctionne&quot;</span>, {</span>
<span id="cb88-2"><a href="package.html#cb88-2" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb88-3"><a href="package.html#cb88-3" aria-hidden="true" tabindex="-1"></a>  liste <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb88-4"><a href="package.html#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="package.html#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_identical</span>(<span class="fu">fix_missing</span>(vec, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">3</span>))</span>
<span id="cb88-6"><a href="package.html#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_identical</span>(<span class="fu">fix_missing</span>(liste, <span class="dv">2</span>), <span class="fu">list</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">3</span>))</span>
<span id="cb88-7"><a href="package.html#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="package.html#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_identical</span>(<span class="fu">fix_missing</span>(vec, <span class="dv">4</span>), vec)</span>
<span id="cb88-9"><a href="package.html#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_identical</span>(<span class="fu">fix_missing</span>(liste, <span class="dv">4</span>), liste)</span>
<span id="cb88-10"><a href="package.html#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="package.html#cb88-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_vector</span>(<span class="fu">fix_missing</span>(vec, <span class="dv">1</span>), <span class="at">ptype =</span> <span class="fu">numeric</span>(), <span class="at">size =</span> <span class="dv">3</span>)</span>
<span id="cb88-12"><a href="package.html#cb88-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_length</span>(<span class="fu">fix_missing</span>(liste, <span class="dv">1</span>), <span class="dv">3</span>)</span>
<span id="cb88-13"><a href="package.html#cb88-13" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Copiez le test ci-dessus dans le fichier <code>tests/testthat/test-fix_missing.R</code>. 
Maintenant, nous allons lancer nos tests pour vérifier que notre code répond bien aux tests que nous avons définis :</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="package.html#cb89-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">test</span>()</span></code></pre></div>
<p>Vous devriez obtenir ce rapport :</p>
<pre><code>Loading monpetitpaquet
Testing monpetitpaquet
√ |  OK F W S | Context
√ |   6       | fix_missing

== Results ==================
OK:       6
Failed:   0
Warnings: 0
Skipped:  0</code></pre>
<p>Nous pouvons calculer le pourcentage de code couvert par des tests (le <em>code coverage</em>) :</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="package.html#cb91-1" aria-hidden="true" tabindex="-1"></a>covr<span class="sc">::</span><span class="fu">package_coverage</span>()</span></code></pre></div>
<pre><code>monpetitpaquet Coverage: 100.00%
R/fix_missing.R: 100.00%</code></pre>
<p>Une première étape a été franchie : nous avons écrit une fonction, nous l’avons documentée, avons inclus des tests et avons un taux de couverture de code de 100%. Nous sommes satisfaits. <strong>C’est le moment de faire un <em>commit</em> suivi d’un <em>push</em>.</strong></p>
<p><em>La suite de cette histoire est imaginaire mais arrive souvent dans la réalité. En effet, nous allons voir qu’il y a un méchant bug caché…</em></p>
<p>Notre fonction <code>fix_missing()</code> est tellement pratique que nous nous mettons à l’utiliser régulièrement. Un jour nous rencontrons la situation suivante. Nous devons traiter ces données :</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="package.html#cb93-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">25</span>, <span class="sc">-</span><span class="dv">99</span>, <span class="sc">-</span><span class="dv">98</span>, <span class="dv">37</span>, <span class="dv">52</span>)</span></code></pre></div>
<p>La documentation des données nous indique que les valeurs <code>-98</code> et <code>-99</code> sont des valeurs manquantes. Nous allons donc utiliser notre fonction <code>fix_missing()</code> :</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="package.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fix_missing</span>(data, <span class="fu">c</span>(<span class="sc">-</span><span class="dv">98</span>, <span class="sc">-</span><span class="dv">99</span>))</span></code></pre></div>
<p>Et là, c’est le drame… voici ce que renvoie le code ci-dessus :</p>
<pre><code>## [1]  18  25 -99 -98  37  52</code></pre>
<p>Alors que nous nous attendions à obtenir :</p>
<pre><code>## [1] 18 25 NA NA 37 52</code></pre>
<p>Que s’est-il passé ?</p>
<p><em>À travers cet exemple, nous allons voir l’application concrète des deux règles d’or mentionnées plus haut.</em></p>
<p>La première règle d’or est que <strong>toute fonctionnalité non testée comprend un bug</strong>.</p>
<p>Qu’avons-nous oublier de tester ?<br />
Nous avons écrit dans notre documentation :</p>
<pre><code>na.value La valeur que l&#39;on souhaite recoder en valeur manquante (`NA`).</code></pre>
<p>Il faudrait donc que notre fonction génère une erreur dans le cas où <code>na.value</code> comprend plus d’une valeur.</p>
<p>La seconde règle d’or indique que <strong>tout bug doit conduire à l’écriture d’un test</strong>. Notre test sera donc le suivant :</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="package.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;na.value doit être de longueur 1&quot;</span>, {</span>
<span id="cb98-2"><a href="package.html#cb98-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">25</span>, <span class="sc">-</span><span class="dv">99</span>, <span class="sc">-</span><span class="dv">98</span>, <span class="dv">37</span>, <span class="dv">52</span>)</span>
<span id="cb98-3"><a href="package.html#cb98-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-4"><a href="package.html#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_error</span>(<span class="fu">fix_missing</span>(data, <span class="fu">c</span>(<span class="sc">-</span><span class="dv">98</span>, <span class="sc">-</span><span class="dv">99</span>)))</span>
<span id="cb98-5"><a href="package.html#cb98-5" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Incluez ce test après le précédent dans le fichier <code>tests/testthat/test-fix_missing.R</code> et exécutez :</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="package.html#cb99-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">test</span>()</span></code></pre></div>
<pre><code>Loading monpetitpaquet
Testing monpetitpaquet
√ |  OK F W S | Context
x |   6 1     | fix_missing
--------------------------------------------------------------------------------
test-fix_missing.R:20: failure: na.value doit être de longueur 1
`fix_missing(data, c(-98, -99))` did not throw an error.
--------------------------------------------------------------------------------

== Results =====================================================================
OK:       6
Failed:   1
Warnings: 0
Skipped:  0</code></pre>
<p>Nous vous laissons corriger la fonction <code>fix_missing()</code> jusqu’à ce que les tests soient tous OK, méditer sur les règles d’or et l’importance des tests. <strong>N’oubliez pas de faire un <em>commit</em> suivi d’un <em>push</em> après cela !</strong></p>
<p>Remarquez enfin que nous avons d’abord écrit un test avant de modifier le code de la fonction <code>fix_missing()</code>. Cette approche s’appelle le <em>test driven development</em>…</p>
<p>On voit ici tout l’intérêt de mettre son code dans un <em>package</em> : on peut facilement y inclure des tests et l’améliorer au fur et à mesure. Alors que si vous réutilisez des bouts de code de programme en programme, la détection d’un bug rend le travail de correction quasi-impossible (et imaginez si vous avez passé vos programmes à des collègues qui les ont déjà réutilisés…). <strong>La seule façon sérieuse de réutiliser du code pour soi-même ou quelqu’un d’autre est donc au travers d’un <em>package</em> que vous aurez documenté et qui pourra être amélioré.</strong></p>
<p>En guise d’exercice, vous pouvez également chercher les autres bugs qui restent dans <code>fix_missing()</code>.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<p>Voici la version de la fonction <code>fix_missing()</code> que nous utiliserons par la suite :</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="package.html#cb101-1" aria-hidden="true" tabindex="-1"></a>fix_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(x, na.value) {</span>
<span id="cb101-2"><a href="package.html#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb101-3"><a href="package.html#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.vector</span>(na.value),</span>
<span id="cb101-4"><a href="package.html#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">identical</span>(<span class="fu">length</span>(na.value), 1L)</span>
<span id="cb101-5"><a href="package.html#cb101-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb101-6"><a href="package.html#cb101-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-7"><a href="package.html#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.factor</span>(x)) {</span>
<span id="cb101-8"><a href="package.html#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">factor</span>(x, <span class="at">exclude =</span> na.value))</span>
<span id="cb101-9"><a href="package.html#cb101-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb101-10"><a href="package.html#cb101-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-11"><a href="package.html#cb101-11" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">==</span> na.value] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb101-12"><a href="package.html#cb101-12" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb101-13"><a href="package.html#cb101-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="déclarer-une-dépendance" class="section level3 hasAnchor" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Déclarer une dépendance<a href="package.html#déclarer-une-dépendance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dans cette partie, nous allons utiliser le cas pratique suivant.</p>
<p>Nous souhaitons que <code>monpetitpaquet</code> offre une fonction <code>fix_missing_df</code> qui fonctionne pour les data frames.</p>
<p>Comme nous l’avons vu précédemment, nous pouvons l’écrire ainsi :</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="package.html#cb102-1" aria-hidden="true" tabindex="-1"></a>fix_missing_df <span class="ot">&lt;-</span> <span class="cf">function</span>(x, na.value) {</span>
<span id="cb102-2"><a href="package.html#cb102-2" aria-hidden="true" tabindex="-1"></a>  x[] <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(x, fix_missing, <span class="at">na.value =</span> na.value)</span>
<span id="cb102-3"><a href="package.html#cb102-3" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb102-4"><a href="package.html#cb102-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>L’objectif de cette partie va être d’apprendre à utiliser une fonction fournie par un autre <em>package</em>. En l’occurrence, il s’agit ici de la fonction <code>purrr::map()</code>.</p>
<p>Mais tout d’abord, nous allons appliquer ce que nous avons vu précédemment :</p>
<ul>
<li>créer un nouveau fichier pour le code source : <code>usethis::use_r("fix_missing_df")</code>;</li>
<li>créer un nouveau fichier pour les tests : <code>usethis::use_test("fix_missing_df")</code>;</li>
<li>documenter la fonction;</li>
<li>construire la documentation attendue par <code>R</code> : <code>devtools::document()</code>;</li>
<li>écrire des tests;</li>
<li>lancer les tests : <code>devtools::test()</code>;</li>
<li>lancer les contrôles de conformité : <code>devtools::check()</code>.</li>
</ul>
<p>Essayez de le faire par vous-même. Pour la documentation de la fonction, vous pouvez utiliser l’astuce suivante: il est possible de réutiliser la documentation d’un paramètre d’une fonction grâce à la directive <code>@inheritParams nomdelafonction</code><a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>. Dans notre exemple, cela peut être utile pour documenter le paramètre <code>na.value</code> de la fonction <code>fix_missing_df</code> en réutilisant celle de la fonction <code>fix_missing</code>. Vous évitez ainsi de faire des copier-coller et votre documentation sera plus facile à mettre à jour. <strong>Utilisez cette astuce le plus souvent possible</strong>. Pour le paramètre <code>...</code>, la directive est <code>@inheritDotParams</code>.</p>
<p>Voici une solution possible pour la fonction <code>fix_missing_df()</code> :</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="package.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Recode une valeur en valeur manquante dans un data frame</span></span>
<span id="cb103-2"><a href="package.html#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb103-3"><a href="package.html#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; La fonction `fix_missing_df()` permet de recoder une valeur</span></span>
<span id="cb103-4"><a href="package.html#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; manquante dans l&#39;ensemble d&#39;un `data.frame`.</span></span>
<span id="cb103-5"><a href="package.html#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb103-6"><a href="package.html#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x Un `data.frame`.</span></span>
<span id="cb103-7"><a href="package.html#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @inheritParams fix_missing</span></span>
<span id="cb103-8"><a href="package.html#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb103-9"><a href="package.html#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Un objet de classe `data.frame`.</span></span>
<span id="cb103-10"><a href="package.html#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @encoding UTF-8</span></span>
<span id="cb103-11"><a href="package.html#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb103-12"><a href="package.html#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb103-13"><a href="package.html#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; df &lt;- data.frame(a = c(12, 23, -99),</span></span>
<span id="cb103-14"><a href="package.html#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;                  b = c(-99, 45, 56))</span></span>
<span id="cb103-15"><a href="package.html#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fix_missing_df(df, -99)</span></span>
<span id="cb103-16"><a href="package.html#cb103-16" aria-hidden="true" tabindex="-1"></a>fix_missing_df <span class="ot">&lt;-</span> <span class="cf">function</span>(x, na.value) {</span>
<span id="cb103-17"><a href="package.html#cb103-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">inherits</span>(x, <span class="st">&quot;data.frame&quot;</span>))</span>
<span id="cb103-18"><a href="package.html#cb103-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-19"><a href="package.html#cb103-19" aria-hidden="true" tabindex="-1"></a>  x[] <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(x, fix_missing, <span class="at">na.value =</span> na.value)</span>
<span id="cb103-20"><a href="package.html#cb103-20" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb103-21"><a href="package.html#cb103-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>et les tests associés :</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="package.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;x doit être un data.frame&quot;</span>, {</span>
<span id="cb104-2"><a href="package.html#cb104-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb104-3"><a href="package.html#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_error</span>(<span class="fu">fix_missing_df</span>(data, <span class="dv">1</span>))</span>
<span id="cb104-4"><a href="package.html#cb104-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb104-5"><a href="package.html#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="package.html#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;fix_missing_df fonctionne&quot;</span>, {</span>
<span id="cb104-7"><a href="package.html#cb104-7" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb104-8"><a href="package.html#cb104-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">entier =</span> <span class="fu">c</span>(1L, 2L, <span class="sc">-</span>99L),</span>
<span id="cb104-9"><a href="package.html#cb104-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">reel =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="sc">-</span><span class="dv">99</span>),</span>
<span id="cb104-10"><a href="package.html#cb104-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">caracteres =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;-99&quot;</span>),</span>
<span id="cb104-11"><a href="package.html#cb104-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">facteur =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;-99&quot;</span>)),</span>
<span id="cb104-12"><a href="package.html#cb104-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb104-13"><a href="package.html#cb104-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-14"><a href="package.html#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="package.html#cb104-15" aria-hidden="true" tabindex="-1"></a>  expected_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb104-16"><a href="package.html#cb104-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">entier =</span> <span class="fu">c</span>(1L, 2L, <span class="cn">NA</span>),</span>
<span id="cb104-17"><a href="package.html#cb104-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">reel =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>),</span>
<span id="cb104-18"><a href="package.html#cb104-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">caracteres =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="cn">NA</span>),</span>
<span id="cb104-19"><a href="package.html#cb104-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">facteur =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="cn">NA</span>)),</span>
<span id="cb104-20"><a href="package.html#cb104-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb104-21"><a href="package.html#cb104-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-22"><a href="package.html#cb104-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-23"><a href="package.html#cb104-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_identical</span>(<span class="fu">fix_missing_df</span>(df, <span class="sc">-</span><span class="dv">99</span>), expected_df)</span>
<span id="cb104-24"><a href="package.html#cb104-24" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Normalement, vous obtenez un <em>warning</em> au moment du contrôle de conformité. Ce <em>warning</em> est le suivant :</p>
<pre><code>❯ checking dependencies in R code ... WARNING
  &#39;::&#39; or &#39;:::&#39; import not declared from: ‘purrr’

0 errors ✔ | 1 warning ✖ | 0 notes ✔</code></pre>
<p>Le contrôle de conformité a détecté que vous souhaitiez utiliser une fonction issue du <em>package</em> <strong>purrr</strong>.</p>
<p>Contrairement à vos programmes habituels, <strong>vous ne devez <em>jamais</em> utiliser <code>library()</code> dans le code source d’un <em>package</em></strong>. Cela est aussi valable pour <code>require()</code>.</p>
<p>Si vous souhaitez utiliser une fonction fournie par un autre <em>package</em> que le votre, <strong>vous devez déclarer explicitement l’utilisation de ce <em>package</em></strong>. Cette déclaration peut s’effectuer grâce à la fonction <code>usethis::use_package()</code>.</p>
<p>Comme nous souhaitons utiliser une fonction du <em>package</em> <code>purrr</code>, notre <em>package</em> doit le déclarer. Donc, il faut que vous exécutiez <code>usethis::use_package("purrr")</code>. Cela va mettre à jour le fichier <code>DESCRIPTION</code> et rajouter <code>purrr</code> dans la rubrique <code>Imports</code>.</p>
<p>Note : vous pouvez également spécifier un numéro de version minimale pour le <em>package</em> <code>purrr</code> en tapant par exemple, <code>usethis::use_package("purrr", min_version = "0.3.0")</code>.
Que signifie exactement la rubrique <code>Imports</code> ? Au moment où un utilisateur va installer votre <em>package</em>, <code>R</code> va vérifier si les <em>packages</em> déclarés dans <code>Imports</code> sont bien présents avec la version minimale requise. Si ce n’est pas le cas, <code>R</code> va les installer. C’est le mécanisme le plus robuste qui permet d’assurer que votre utilisateur dispose bien des <em>packages</em> indispensables à l’exécution de vos programmes.</p>
<p>En revanche, un <em>package</em> déclaré dans la rubrique <code>Imports</code> n’est pas équivalent à un appel à <code>library()</code>. Il existe bien la rubrique <code>Depends</code> qui est très proche d’un appel à <code>library()</code> mais <strong>attention, l’utilisation de <code>Depends</code> est désormais considérée comme une très mauvaise pratique : ne l’utilisez jamais!</strong></p>
<p>Une fois qu’un <em>package</em> est déclaré dans la rubrique <code>Imports</code> du fichier <code>DESCRIPTION</code>, vous devez donc utiliser <code>::</code> pour utiliser ses fonctions dans votre code source. Cependant, il y a des cas où l’utilisation de <code>::</code> n’est vraiment pas aisée et peut dégrader la lisibilité de votre code.</p>
<p>Dans ce cas, vous pouvez importer une fonction de ce <em>package</em> grâce au mot clé roxygen2 <code>@importFrom</code>. Vous n’aurez alors plus besoin d’utiliser <code>::</code> pour cette fonction.</p>
<p>Voici un exemple à partir de la fonction <code>fix_missing_df()</code> :</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="package.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom purrr map</span></span>
<span id="cb106-2"><a href="package.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span>
<span id="cb106-3"><a href="package.html#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="package.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Recode une valeur en valeur manquante dans un data.frame</span></span>
<span id="cb106-5"><a href="package.html#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb106-6"><a href="package.html#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; La fonction `fix_missing_df()` permet de recoder une valeur</span></span>
<span id="cb106-7"><a href="package.html#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; manquante dans l&#39;ensemble d&#39;un `data.frame`.</span></span>
<span id="cb106-8"><a href="package.html#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb106-9"><a href="package.html#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x Un `data.frame`.</span></span>
<span id="cb106-10"><a href="package.html#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @inheritParams fix_missing</span></span>
<span id="cb106-11"><a href="package.html#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb106-12"><a href="package.html#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Un objet de classe `data.frame`.</span></span>
<span id="cb106-13"><a href="package.html#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @encoding UTF-8</span></span>
<span id="cb106-14"><a href="package.html#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb106-15"><a href="package.html#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb106-16"><a href="package.html#cb106-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; df &lt;- data.frame(a = c(12, 23, -99),</span></span>
<span id="cb106-17"><a href="package.html#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;                  b = c(-99, 45, 56))</span></span>
<span id="cb106-18"><a href="package.html#cb106-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fix_missing_df(df, -99)</span></span>
<span id="cb106-19"><a href="package.html#cb106-19" aria-hidden="true" tabindex="-1"></a>fix_missing_df <span class="ot">&lt;-</span> <span class="cf">function</span>(x, na.value) {</span>
<span id="cb106-20"><a href="package.html#cb106-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">inherits</span>(x, <span class="st">&quot;data.frame&quot;</span>))</span>
<span id="cb106-21"><a href="package.html#cb106-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-22"><a href="package.html#cb106-22" aria-hidden="true" tabindex="-1"></a>  x[] <span class="ot">&lt;-</span> <span class="fu">map</span>(x, fix_missing, <span class="at">na.value =</span> na.value)</span>
<span id="cb106-23"><a href="package.html#cb106-23" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb106-24"><a href="package.html#cb106-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>L’utilisation de <code>NULL</code> après la ligne comprenant <code>@importFrom</code> est une petite astuce permettant de sécuriser le fonctionnement de roxygen2.</p>
<p>Une fois que vous avez inclus la directive <code>@importFrom *package* fonction</code>, vous devez mettre à jour le <code>NAMESPACE</code> en exécutant la commande <code>devtools::document()</code>. Le fichier <code>NAMESPACE</code> aura alors ce contenu :</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="package.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generated by roxygen2: do not edit by hand</span></span>
<span id="cb107-2"><a href="package.html#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="package.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(fix_missing)</span>
<span id="cb107-4"><a href="package.html#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(fix_missing_df)</span>
<span id="cb107-5"><a href="package.html#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="fu">importFrom</span>(purrr,map)</span></code></pre></div>
<p>N’oubliez pas de relancer le contrôle de conformité (<code>devtools::check()</code>) pour vérifier que vous avez bien résolu le warning. Puis effectuer un <em>commit</em> suivi d’un <em>push</em>. Dès lors, la fonction <code>map()</code> du <em>package</em> <strong>purrr</strong> pourra être utilisée telle quelle dans le code source de votre <em>package</em>.</p>
<p><strong>N’importez des fonctions que lorsque vous les utilisez à de nombreuses reprises</strong>. En effet, vous devez privilégier l’utilisation de <code>::</code>.</p>
<div id="importation-de" class="section level4 hasAnchor" number="5.3.2.1">
<h4><span class="header-section-number">5.3.2.1</span> Importation de <code>%&gt;%</code><a href="package.html#importation-de" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Si vous souhaitez utiliser le pipe (<code>%&gt;%</code>) du <em>package</em> <strong>magrittr</strong> dans votre code source, vous devez également l’importer. Etant donné que ce besoin est très fréquent, le <em>package</em> <strong>usethis</strong> fournit une fonction utilitaire :</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="package.html#cb108-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_pipe</span>(<span class="at">export =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Si vous souhaitez ré-exporter le pipe pour qu’il soit disponible pour les utilisateurs de votre <em>package</em>, utilisez <code>usethis::use_pipe(export = TRUE)</code>.</p>
<p>Après cette opération, n’oubliez pas d’actualiser le <code>NAMESPACE</code> en exécutant <code>devtools::document()</code>. Effectuez le contrôle de conformité. Lorsqu’il est OK faites un <em>commit</em> suivi d’un <em>push</em>.</p>
</div>
</div>
<div id="charger-lensemble-des-fonctions-de-son-package" class="section level3 hasAnchor" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Charger l’ensemble des fonctions de son <em>package</em><a href="package.html#charger-lensemble-des-fonctions-de-son-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Au bout d’un moment, vous aurez dans votre <em>package</em> :</p>
<ul>
<li>des fonctions exportées (déclarées grâce à la directive <code>@export</code>);</li>
<li>des fonctions internes.</li>
</ul>
<p>Il est fort probable qu’au cours du travail, vous ayez besoin de charger l’ensemble de vos fonctions. Dans ce cas, vous pouvez utiliser la commande :</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="package.html#cb109-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>()</span></code></pre></div>
</div>
</div>
<div id="installer-le-package" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Installer le <em>package</em><a href="package.html#installer-le-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Avant d’installer un <em>package</em> ou de le distribuer, exécuter une dernière fois le contrôle de conformité avec <code>devtools::check()</code>.</p>
<div id="installer-sur-sa-machine" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Installer sur sa machine<a href="package.html#installer-sur-sa-machine" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dans l’onglet <code>Build</code>, cliquer sur <code>Install and restart</code> ou de façon équivalente <code>devtools::install()</code>. Cela installe <code>monpetitpaquet</code> et redémarre votre session. Vous pouvez maintenant vous utiliser les fonctions <code>fix_missing()</code> et <code>fix_missing_df()</code>.</p>
</div>
<div id="générer-le-fichier-compressé" class="section level3 hasAnchor" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Générer le fichier compressé<a href="package.html#générer-le-fichier-compressé" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pour générer le fichier <code>.tar.gz</code> nécessaire à une installation sous AUS par exemple, exécuter <code>devtools::build()</code>. Il est recommandé d’incrémenter systématiquement le numéro de version de votre <em>package</em> avant d’effectuer cette opération.</p>
</div>
</div>
<div id="documenter-un-package" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Documenter un <em>package</em><a href="package.html#documenter-un-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="créer-un-fichier-readme-obligatoire" class="section level3 hasAnchor" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Créer un fichier <code>README</code> (obligatoire)<a href="package.html#créer-un-fichier-readme-obligatoire" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Le fichier <code>README</code> est le premier fichier qui s’affiche lorsque vous consultez votre projet sous GitLab. Tous les projets doivent disposer d’un fichier <code>README</code> : cela fait partie du B.A.-BA. Ne pas disposer d’un tel fichier est considéré comme un manque de professionnalisme important. <strong>Vous devez donc le créer</strong>.<br />
Il comprendra une brève description de votre <em>package</em>, son objectif, les instructions pour l’installer et les consignes pour contribuer au code source. C’est en quelque sorte la page d’accueil de votre projet.</p>
<p>Le fichier <code>README</code> s’écrit en markdown, son extension est donc <code>README.md</code>.</p>
<p>Pour le créer, la commande est :</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="package.html#cb110-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_readme_md</span>()</span></code></pre></div>
<p>Il est possible d’utiliser R Markdown grâce à la commande :</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="package.html#cb111-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_readme_rmd</span>()</span></code></pre></div>
<p>Cette commande crée deux fichiers : <code>README.Rmd</code> et <code>README.md</code>.</p>
<p>Le processus est alors le suivant :</p>
<ul>
<li>vous écrivez dans le fichier <code>README.Rmd</code>;</li>
<li>vous générez le fichier <code>README.md</code> grâce au bouton <em>Knit</em> de RStudio;</li>
<li>vous faites un <em>commit</em> des deux fichiers <code>README.Rmd</code> et <code>README.md</code> puis un <em>push</em>.</li>
</ul>
<p>Seul le fichier <code>README.md</code> s’affiche sous GitLab.</p>
</div>
<div id="créer-une-vignette-recommandé" class="section level3 hasAnchor" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> Créer une vignette (recommandé)<a href="package.html#créer-une-vignette-recommandé" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Jusqu’ici nous avons appris à générer la documentation de chaque fonction. Cette documentation est plutôt à vocation technique. Il existe une autre forme de documentation que vous connaissez certainement : les vignettes.</p>
<p>Les vignettes sont des documentations à vocation plus fonctionnelle : elles expliquent aux utilisateurs comment utiliser en pratique votre <em>package</em>. Pour lister les vignettes offertes par un <em>package</em>, la commande est <code>vignette(package = "dplyr")</code>. La vignette principale a usuellement le même nom que le <em>package</em>. Elle est donc aisément accessible est tapant <code>vignette("dplyr")</code>.</p>
<p>L’intérêt des vignettes est qu’elles sont intégrées aux <em>packages</em>. Elles sont donc consultables sans connexion internet directement depuis RStudio.</p>
<p>Pour créer une nouvelle vignette, rien de plus simple. Il faut exécuter :</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="package.html#cb112-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_vignette</span>(<span class="st">&quot;monpetitpaquet&quot;</span>)</span></code></pre></div>
<p>Cette commande crée un nouveau fichier intitulé <code>monpetitpaquet.Rmd</code> dans le répertoire <code>vignettes</code>. Il s’agit d’un fichier R Markdown. Expliquez dans ce fichier à quoi sert votre <em>package</em> et comment on l’utilise.</p>
<p>Si dans votre vignette vous utilisez un <em>package</em> qui n’est pas recensé dans la rubrique <code>Imports</code> de votre <em>package</em>, vous devez absolument le mentionner dans la rubrique <code>Suggests</code> du fichier <code>DESCRIPTION</code> en utilisant <code>usethis::use_package(type = "Suggests")</code>. Par exemple, si votre <em>package</em> n’importe aucune fonction de <code>dplyr</code> mais la vignette décrit comme l’utiliser avec <code>dplyr</code>, vous devez exécuter:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="package.html#cb113-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="at">type =</span> <span class="st">&quot;Suggests&quot;</span>)</span></code></pre></div>
<p>Pour générer les vignettes, exécutez :</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="package.html#cb114-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">build_vignettes</span>()</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
</div>
<div id="créer-un-modèle-de-document-r-markdown" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> Créer un modèle de document R Markdown<a href="package.html#créer-un-modèle-de-document-r-markdown" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Votre <em>package</em> peut proposer un modèle de document R Markdown prêt à l’emploi. Cette option est très pratique si vous souhaitez avoir sous la main un document type que vous pouvez ensuite adapter.</p>
<p>Lorsqu’on inclut un modèle de document R Markdown dans un <em>package</em>, celui est alors disponible dans RStudio au travers du menu <code>File &gt; New File &gt; R Markdown... &gt; From Template</code>.</p>
<p>Comme exemple d’utilisation, imaginez que vous réalisez une même note tous les mois. Si vous la mettez à disposition dans un <em>package</em>, vous ou vos collègues seront en capacité de la réutiliser aisément. De plus comme il s’agit d’un document R Markdown, l’actualisation ne nécessite que très peu de travail (et aucun copier-coller).</p>
<p>Pour créer un modèle de document R Markdown dans votre <em>package</em>, exécutez :</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="package.html#cb116-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_rmarkdown_template</span>(<span class="st">&quot;note-mensuelle&quot;</span>)</span></code></pre></div>
<p>Il ne vous reste plus qu’à éditer le fichier <code>inst/rmarkdown/templates/note-mensuelle/skeleton/skeleton.Rmd</code>.</p>
<p>En paramétrant ingénieusement l’intégration continue de GitLab, vous pouvez même automatiser la production de la note.</p>
</div>
<div id="bonnes-pratiques" class="section level2 hasAnchor" number="5.7">
<h2><span class="header-section-number">5.7</span> Bonnes pratiques<a href="package.html#bonnes-pratiques" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="créer-un-changelog" class="section level3 hasAnchor" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> Créer un changelog<a href="package.html#créer-un-changelog" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Il est fortement recommandé de tenir un journal de bord retraçant tous les changements intervenus dans votre <em>package</em>. Cela vous permettra de retrouver aisément quand une modification a été faite.</p>
<p>L’habitude est de nommer ce fichier <code>NEWS.md</code>. Pour le créer, exécutez :</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="package.html#cb117-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_news_md</span>()</span></code></pre></div>
</div>
<div id="gérer-les-numéros-de-version" class="section level3 hasAnchor" number="5.7.2">
<h3><span class="header-section-number">5.7.2</span> Gérer les numéros de version<a href="package.html#gérer-les-numéros-de-version" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dans le fichier <code>DESCRIPTION</code>, vous pouvez constater qu’il y a la ligne suivante :</p>
<pre><code>Version: 0.0.0.9000</code></pre>
<p>Il s’agit du numéro de version. La gestion des numéros de version est une affaire largement subjective et il existe plusieurs conventions ce qui fait qu’il est parfois difficile de s’y repérer.</p>
<p>Il faut comprendre les numéros de version de la façon suivante <code>major.minor.patch.dev</code>. Voici quelques règles communnément partagées :</p>
<ul>
<li>lorsque vous voyez une séquence de 4 numéros, il s’agit d’une version en cours de développement, par exemple : <code>1.0.3.9003</code>. Les versions “publiées” ont au maximum 3 numéros. Pourquoi le dernier nombre est si élevé (9003) ? C’est pour signaler qu’on prépare la version suivante, qui sera supérieure à <code>1.0.3</code> (il y a des chances pour que ce soit la <code>1.0.4</code>).</li>
<li>il faut très souvent incrémenter les numéros de version (dès que vous faites une petite modification sur votre code source). C’est pour cela que beaucoup de personnes utilisent la 4ème position.</li>
<li>à un moment ou à un autre, vous devez publier une version qui ne soit pas une version de développement (3 positions maximum).</li>
<li>s’agissant des versions publiées (3 positions maximum), n’incrémentez la version majeure que si vous avez des bouleversements importants. Il est fréquent de croiser des <em>packages</em> en version <code>0.x</code>. Le fait de rester en version majeure 0 est le signe que l’auteur du <em>package</em> considère que son oeuvre n’est pas terminée. En effet, beaucoup de personnes considèrent que la version 1 est un travail presque parfait. Il s’agit d’un réel aboutissement.</li>
</ul>
<p>Pour vous aider, vous pouvez utiliser <code>usethis::use_version()</code> ou <code>usethis::use_dev_version()</code>. Cette commande actualise automatiquement le fichier <code>NEWS.md</code>.</p>
</div>
</div>
<div id="conclusion---pour-aller-plus-loin" class="section level2 hasAnchor" number="5.8">
<h2><span class="header-section-number">5.8</span> Conclusion - Pour aller plus loin<a href="package.html#conclusion---pour-aller-plus-loin" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Voilà, vous connaissez l’essentiel pour réaliser des <em>packages</em>.</p>
<p>Comme vous avez pu le constater, un <em>package</em> c’est du code <code>R</code> avec beaucoup de documentation autour ainsi que des tests. L’intérêt de regrouper votre travail dans un <em>package</em> est que cela vous obligera à documenter au fur et à mesure (sinon le contrôle de conformité sera en erreur), ce qui est moins pénible que de tout documenter à la fin d’un projet.</p>
<p>Voici quelques références si vous souhaitez approfondir vos connaissances sur la création de <em>packages</em> :</p>
<ul>
<li><p><em>Créer un package <code>R</code> en quelques minutes</em>, par ThinkR, <a href="https://thinkr.fr/creer-package-r-quelques-minutes" class="uri">https://thinkr.fr/creer-package-r-quelques-minutes</a>.</p></li>
<li><p>Présentation sur le développement de <em>packages</em> avec RStudio et git, par Martin Chevalier, <a href="https://git.stable.innovation.insee.eu/formation/r_dev/raw/master/presentation/presentation.pdf" class="uri">https://git.stable.innovation.insee.eu/formation/r_dev/raw/master/presentation/presentation.pdf</a>.</p></li>
<li><p><em>Package Development Cheat Sheet</em>, <a href="https://github.com/rstudio/cheatsheets/raw/master/package-development.pdf" class="uri">https://github.com/rstudio/cheatsheets/raw/master/package-development.pdf</a>.</p></li>
<li><p><em>R Packages</em>, par Hadley Wickham, <a href="http://r-pkgs.had.co.nz/" class="uri">http://r-pkgs.had.co.nz/</a>.</p></li>
<li><p>La documentation officielle : <em>Writing <code>R</code> Extensions</em>, <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html" class="uri">https://cran.r-project.org/doc/manuals/r-release/R-exts.html</a>.</p></li>
</ul>
<p>Et si vous souhaitez voir comment on devait faire avant les <em>packages</em> <strong>devtools</strong>, <strong>usethis</strong> et <strong>testthat</strong> : <a href="https://cran.r-project.org/doc/contrib/Genolini-ConstruireUnPackage.pdf" class="uri">https://cran.r-project.org/doc/contrib/Genolini-ConstruireUnPackage.pdf</a>.</p>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
Wickham, Hadley. 2015. <em>R Packages: Organize, Test, Document, and Share Your Code</em>. " O’Reilly Media, Inc.".
</div>
</div>
</div>
</div>













<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-wickham2015r" class="csl-entry">
Wickham, Hadley. 2015. <em>R Packages: Organize, Test, Document, and Share Your Code</em>. " O’Reilly Media, Inc.".
</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>il existe une technique pour accéder aux fonctions internes d’un <em>package</em> mais il n’est jamais recommandé de l’utiliser. Nous ne la présenterons donc pas.<a href="package.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>vous pouvez y accéder directement depuis <code>R</code> en exécutant <code>RShowDoc("R-exts")</code>.<a href="package.html#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Bioconductor est un registre de <em>packages</em> essentiellement dédiés à la bioinformatique. Il est très populaire dans ce domaine. Le CRAN et Bioconductor sont deux registres “officiels” qui présentent bien plus de garanties que GitHub.<a href="package.html#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>cela nécessite au moins la version <code>6.0.0</code> du <em>package</em> <strong>roxygen2</strong>.<a href="package.html#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>indice : nous n’avons pas testé <code>fix_missing()</code> sur un facteur.<a href="package.html#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>pour réutiliser la documentation d’un autre <em>package</em>, utilisez <code>@inheritParams package::nomdelafonction</code><a href="package.html#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="git.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
